(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,s=window.wp.components,r=window.wp.i18n,n=window.wp.apiFetch;var a=e.n(n);const c=async e=>{let{planIds:t,title:s,ajax_url:r,includeIds:n}=e;const c=new FormData;return c.append("action","suremembers_postmeta_search"),c.append("security",suremembers_global.suremembers_postmeta_security),t&&c.append("selected_ids",t.map((e=>e.id))),n&&c.append("include_ids",n),s&&""!==s&&c.append("search_title",s),await a()({url:r,method:"POST",body:c}).then((e=>e))},o=e=>{let{props:s,planIds:r,setPlanIds:n,setPlanIdsHandler:a,setFocusOninput:o,showAccess:l,setShowAccess:i,inputRef:u,setShowAccessError:m,searchValue:d,setSearchValue:p}=e;const b=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s={planIds:r,title:d,ajax_url:suremembers_global.ajax_url};t&&(s={...s,...t});const a=c(s);a.then((s=>{if(!s.success||!1===s.success)return i(!1),void(s.data.message&&m(s.data.message));if(e){if(i([...s.data,...r]),t.includeIds){const e=s.data.filter((e=>t.includeIds.includes(e.id)));n(e)}}else i(s.data)}))};return(0,t.useEffect)((()=>{if(null!==d){if(d&&d.length>1){const e=setTimeout((()=>{b()}),500);return()=>{clearTimeout(e)}}}else b()}),[d]),(0,t.useEffect)((()=>{s.attributes.sureMemberRestrictions&&s.attributes.sureMemberRestrictions.length?b(!0,{includeIds:s.attributes.sureMemberRestrictions}):i(l)}),[]),(0,t.createElement)("input",{onBlur:()=>{o(!1)},onfocusin:()=>{o(!0)},ref:u,className:"search-input",type:"text",value:d||"",onChange:e=>{const{value:t}=e.target;p((()=>""===t?null:t))},onKeyDown:e=>{if(8===e.keyCode&&""===e.target.value&&r.length>0){const e=[...r].length-1;a("remove",e)}}})},l=e=>{let{props:s,planIds:r,setPlanIds:n,setPlanIdsHandler:a,setFocusOninput:c,inputRef:l,showAccess:i,setShowAccess:u,setShowAccessError:m,addRemoveFromAttr:d,searchValue:p,setSearchValue:b}=e;const h=(0,t.createElement)(o,{props:s,planIds:r,setPlanIds:n,setPlanIdsHandler:a,setFocusOninput:c,showAccess:i,setShowAccess:u,inputRef:l,setShowAccessError:m,searchValue:p,setSearchValue:b}),w=r.length>=1&&r.map(((e,s)=>{const n=e.title.length>18?e.title.substring(0,18)+"...":e.title;return(0,t.createElement)("span",{className:"suremembers-group-item",key:s},n,(0,t.createElement)("span",{onClick:()=>{const t=[...r].findIndex((t=>t.id===e.id));d("remove",e.id),a("remove",t)},className:"dashicons dashicons-no-alt"}))}));return(0,t.createElement)(t.Fragment,null,w,h)},i=e=>{let{planIds:s,setPlanIdsHandler:r,showAccess:n,showAccessError:a}=e;if(!1===n)return(0,t.createElement)("div",{className:"suremembers-post-meta-restricted-post-result"},(0,t.createElement)("span",{className:"suremembers-not-found-error"},a));const c=n.length?n.map(((e,n)=>s.findIndex((t=>t.id===e.id))>=0?null:(0,t.createElement)("div",{onClick:()=>{const t={id:e.id,title:e.title};r("add",t)},key:n},(0,t.createElement)("span",{className:"suremembers-title"},e.title)))):null;return c&&(0,t.createElement)("div",{className:"suremembers-post-meta-restricted-post-result"},c)},u=function(e){const{sure_member_access_groups:n,sure_member_create_group:a}=suremembers_global,{attributes:c,setAttributes:o}=e,u=n&&n[0]?n:[],[m,d]=(0,t.useState)([]),[p,b]=(0,t.useState)(u),[h,w]=(0,t.useState)((0,r.__)("Plan's are not available.","suremembers")),[f,E]=(0,t.useState)(!1),[_,g]=(0,t.useState)(!1),[v,I]=(0,t.useState)(""),S=(0,t.useRef)(null),A=(0,t.useRef)(null),y=(e,t)=>{const s=c.sureMemberRestrictions?[...c.sureMemberRestrictions]:[];if("add"===e)s.push(t);else{const e=s.indexOf(t);s.splice(e,1)}o({sureMemberRestrictions:s})},R=(e,t)=>{"add"===e?(d((e=>{const s=[...e];return s.push(t),s})),y("add",t.id),g(!1),I(null)):"remove"===e&&d((e=>{const s=[...e];return s.splice(t,1),s}))};function N(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter(Boolean).join(" ")}return(0,t.useEffect)((()=>{if(_)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)};function e(e){A.current&&!A.current.contains(e.target)&&g(!1)}}),[A,_]),(0,t.createElement)(s.PanelBody,{title:(0,r.__)("Restrict This Block","suremembers"),initialOpen:!1},a&&""!==a?(0,t.createElement)("a",{className:"suremembers-create-group",href:a,target:"_blank",rel:"noreferrer"},(0,r.__)("Add Access Group","suremembers")):n&&n.length?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:"suremembers-post-meta-choose",ref:A},(0,t.createElement)("div",{className:"suremembers-post-meta-restrcited-content "+(f?"suremembers-focuson":"")},(0,t.createElement)("div",{className:"suremembers-post-meta-restrcited-post-provider"},(0,t.createElement)("div",{className:"components-base-control"},(0,t.createElement)("label",{className:"suremembers-label-head"},(0,r.__)("Show block when user ","suremembers")),(0,t.createElement)(s.ButtonGroup,null,(0,t.createElement)(s.Button,{onClick:()=>{o({sureMemberShowOnRestriction:"is_in"})},className:N("is_in"===c.sureMemberShowOnRestriction?"is-primary":"is-secondary","components-button")},(0,r.__)("Is In","suremembers")),(0,t.createElement)(s.Button,{onClick:()=>{o({sureMemberShowOnRestriction:"is_not_in"})},className:N("is_not_in"===c.sureMemberShowOnRestriction?"is-primary":"is-secondary","components-button")},(0,r.__)("Is Not In","suremembers")))),(0,t.createElement)("label",{className:"suremembers-label-head"},(0,r.__)("Access Groups","suremembers")),(0,t.createElement)("div",{className:"suremembers-multiple-plans-container"},(0,t.createElement)("div",{className:"suremembers-input-added-group",onClick:()=>{E(!0),g(!0),S.current.focus()}},(0,t.createElement)(l,{props:e,planIds:m,setPlanIds:d,setPlanIdsHandler:R,focusOninput:f,setFocusOninput:E,inputRef:S,showAccess:p,setShowAccess:b,setShowAccessError:w,addRemoveFromAttr:y,searchValue:v,setSearchValue:I})),_&&(0,t.createElement)(i,{props:e,planIds:m,setPlanIdsHandler:R,showAccess:p,showAccessError:h})))))):"")},{createHigherOrderComponent:m}=wp.compose,{InspectorControls:d}=wp.blockEditor,p=m((e=>s=>{const{isSelected:r}=s;return!0===r?(0,t.createElement)(t.Fragment,null,(0,t.createElement)(e,s),(0,t.createElement)(d,null,(0,t.createElement)(u,s))):(0,t.createElement)(e,s)}),"withInspectorControl");wp.hooks.addFilter("blocks.registerBlockType","sure-cart/with-inspector-controls",(function(e){return e.attributes&&(e.attributes={...e.attributes,sureMemberRestrictions:{type:"array",default:[]},sureMemberShowOnRestriction:{type:"string",default:"is_in"}}),e})),wp.hooks.addFilter("editor.BlockEdit","sure-cart/with-inspector-controls",p)})();