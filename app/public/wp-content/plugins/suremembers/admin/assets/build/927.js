"use strict";(globalThis.webpackChunksuremembers=globalThis.webpackChunksuremembers||[]).push([[927],{927:(t,e,s)=>{s.r(e),s.d(e,{sc_paystack_add_method:()=>o});var a=s(4589),r=s(3659),n=s(9740),i=s(9964);s(857);const o=class{constructor(t){(0,a.r)(this,t),this.liveMode=!0,this.customerId=void 0,this.successUrl=void 0,this.currency=void 0,this.loading=void 0,this.loaded=void 0,this.error=void 0,this.paymentIntent=void 0}async handlePaymentIntentCreate(){var t,e;const{public_key:s,access_code:a}=(null===(e=null===(t=this.paymentIntent)||void 0===t?void 0:t.processor_data)||void 0===e?void 0:e.paystack)||{};if(!s||!a)return;const i=new n.s;await i.newTransaction({key:s,accessCode:a,onSuccess:async t=>{if("success"!==(null==t?void 0:t.status))throw{message:(0,r.s)((0,r._)("Paystack transaction could not be finished. Status: %s","surecart"),null==t?void 0:t.status)};window.location.assign(this.successUrl)},onClose:t=>{console.error(t),alert((null==t?void 0:t.message)||(0,r._)("The payment did not process. Please try again.","surecart"))}})}async createPaymentIntent(){var t,e;try{this.loading=!0,this.error="",this.paymentIntent=await(0,i.a)({method:"POST",path:"surecart/v1/payment_intents",data:{processor_type:"paystack",reusable:!0,live_mode:this.liveMode,customer_id:this.customerId,currency:this.currency,refresh_status:!0}})}catch(s){this.error=(null===(e=null===(t=null==s?void 0:s.additional_errors)||void 0===t?void 0:t[0])||void 0===e?void 0:e.message)||(null==s?void 0:s.message)||(0,r._)("Something went wrong","surecart")}finally{this.loading=!1}}render(){return(0,a.h)(a.H,null,this.error&&(0,a.h)("sc-alert",{open:!!this.error,type:"danger"},(0,a.h)("span",{slot:"title"},(0,r._)("Error","surecart")),this.error),(0,a.h)("div",{class:"sc-paystack-button-container"},(0,a.h)("sc-alert",{open:!0,type:"warning"},(0,r._)("In order to add a new card, we will need to make a small transaction to authenticate it. This is for authentication purposes and will be immediately refunded.","surecart"),(0,a.h)("div",null,(0,a.h)("sc-button",{loading:this.loading,type:"primary",onClick:()=>this.createPaymentIntent(),style:{marginTop:"var(--sc-spacing-medium)"}},(0,r._)("Add New Card","surecart"))))))}static get watchers(){return{paymentIntent:["handlePaymentIntentCreate"]}}};o.style=":host{display:block}"}}]);