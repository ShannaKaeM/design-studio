"use strict";(globalThis.webpackChunksuremembers=globalThis.webpackChunksuremembers||[]).push([[3390],{3390:(e,t,i)=>{i.r(t),i.d(t,{sc_login_form:()=>a});var s=i(4589),r=i(3659),o=i(9964);i(857);const a=class{constructor(e){(0,s.r)(this,e),this.step=0,this.email="",this.password="",this.verifyCode="",this.loading=void 0,this.error=void 0}handleStepChange(){1===this.step&&setTimeout((()=>{var e,t;null===(t=null===(e=this.passwordInput)||void 0===e?void 0:e.triggerFocus)||void 0===t||t.call(e)}),50),2===this.step&&setTimeout((()=>{var e,t;null===(t=null===(e=this.codeInput)||void 0===e?void 0:e.triggerFocus)||void 0===t||t.call(e)}),50)}handleLoadingChange(e){e&&(this.error=null)}handleVerifyCodeChange(e){(null==e?void 0:e.length)>=6&&this.submitCode()}handleError(e){console.error(this.error),this.error=e||{message:(0,r._)("Something went wrong","surecart")}}async createLoginCode(){try{this.loading=!0,await(0,o.a)({method:"POST",path:"surecart/v1/verification_codes",data:{login:this.email}}),this.step=this.step+1}catch(e){this.handleError(e)}finally{this.loading=!1}}async submitCode(){try{this.loading=!0;const{verified:e}=await(0,o.a)({method:"POST",path:"surecart/v1/verification_codes/verify",data:{login:this.email,code:this.verifyCode}});if(!e)throw{message:(0,r._)("Verification code is not valid. Please try again.","surecart")};window.location.reload()}catch(e){this.handleError(e),this.loading=!1}}async login(){try{this.loading=!0;const{redirect_url:e}=await(0,o.a)({method:"POST",path:"surecart/v1/login",data:{login:this.email,password:this.password}});e?window.location.replace(e):window.location.reload()}catch(e){this.handleError(e),this.loading=!1}}async checkEmail(){try{this.loading=!0,await(0,o.a)({method:"POST",path:"surecart/v1/check_email",data:{login:this.email}}),this.step=this.step+1}catch(e){this.handleError(e)}finally{this.loading=!1}}renderInner(){return 2===this.step?(0,s.h)(s.F,null,(0,s.h)("div",{class:"login-form__title",part:"title"},(0,r._)("Check your email for a confirmation code","surecart")),(0,s.h)("div",null,(0,s.h)("sc-form",{onScFormSubmit:()=>this.submitCode()},(0,s.h)("sc-input",{label:(0,r._)("Confirmation code","surecart"),type:"text",ref:e=>this.codeInput=e,autofocus:!0,required:!0,onScInput:e=>this.verifyCode=e.target.value}),(0,s.h)("sc-button",{type:"primary",submit:!0,full:!0},(0,s.h)("sc-icon",{name:"lock",slot:"prefix"}),(0,r._)("Login with Code","surecart"))))):1===this.step&&this.email?(0,s.h)(s.F,null,(0,s.h)("div",{class:"login-form__title",part:"title"},(0,s.h)("div",null,(0,r._)("Welcome","surecart")),(0,s.h)("sc-button",{style:{fontSize:"18px"},size:"small",pill:!0,caret:!0,onClick:()=>this.step=this.step-1},(0,s.h)("sc-icon",{name:"user",slot:"prefix"}),this.email)),(0,s.h)("sc-flex",{flexDirection:"column",style:{"--sc-flex-column-gap":"var(--sc-spacing-large)"}},(0,s.h)("div",null,(0,s.h)("sc-form",{onScFormSubmit:()=>this.createLoginCode()},(0,s.h)("sc-button",{class:"login-code",type:"primary",submit:!0,full:!0},(0,s.h)("sc-icon",{name:"mail",slot:"prefix"}),(0,r._)("Send a login code","surecart"))),(0,s.h)("sc-divider",{style:{"--spacing":"0.5em"}},(0,r._)("or","surecart")),(0,s.h)("sc-form",{onScFormSubmit:()=>this.login()},(0,s.h)("sc-input",{label:(0,r._)("Enter your password","surecart"),type:"password",ref:e=>this.passwordInput=e,onKeyDown:e=>"Enter"===e.key&&this.login(),autofocus:!0,required:!0,onScInput:e=>this.password=e.target.value}),(0,s.h)("sc-button",{type:"primary",outline:!0,submit:!0,full:!0},(0,s.h)("sc-icon",{name:"lock",slot:"prefix"}),(0,r._)("Login","surecart")))))):(0,s.h)(s.F,null,(0,s.h)("div",{class:"login-form__title",part:"title"},(0,s.h)("slot",{name:"title"})),(0,s.h)("sc-form",{onScFormSubmit:()=>this.checkEmail()},(0,s.h)("sc-input",{type:"text",value:this.email,label:(0,r._)("Username or Email Address","surecart"),onScInput:e=>this.email=e.target.value,onKeyDown:e=>"Enter"===e.key&&this.checkEmail(),required:!0,autofocus:!0}),(0,s.h)("sc-button",{type:"primary",submit:!0,full:!0},(0,s.h)("sc-icon",{name:"arrow-right",slot:"suffix"}),(0,r._)("Next","surecart"))))}render(){var e,t;return(0,s.h)("div",{class:"login-form"},(0,s.h)("sc-card",null,!!this.error&&(0,s.h)("sc-alert",{open:!0,type:"danger",closable:!0,onScHide:()=>this.error=null},(0,s.h)("span",{slot:"title",innerHTML:null===(e=this.error)||void 0===e?void 0:e.message}),((null===(t=this.error)||void 0===t?void 0:t.additional_errors)||[]).map((({message:e})=>(0,s.h)("div",{innerHTML:e})))),this.renderInner()),this.loading&&(0,s.h)("sc-block-ui",{spinner:!0,style:{zIndex:"9","--sc-block-ui-opacity":"0.5"}}))}static get watchers(){return{step:["handleStepChange"],loading:["handleLoadingChange"],verifyCode:["handleVerifyCodeChange"]}}};a.style=".login-form{font-size:16px;margin:var(--sc-spacing-xx-large) auto;max-width:400px;position:relative}.login-form__title{margin-bottom:var(--sc-spacing-medium);font-size:var(--sc-font-size-xx-large);font-weight:var(--sc-font-weight-bold);line-height:var(--sc-line-height-dense);text-align:var(--sc-login-text-align, center)}.login-form__back{text-align:center;font-size:var(--sc-font-size-small)}sc-card{--sc-card-padding:var(--sc-spacing-xx-large)}"}}]);