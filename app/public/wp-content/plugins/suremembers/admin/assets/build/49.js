/*! For license information please see 49.js.LICENSE.txt */
"use strict";(globalThis.webpackChunksuremembers=globalThis.webpackChunksuremembers||[]).push([[49],{4388:(t,e,r)=>{function n(t,e){void 0===e&&(e={});var r=document.createElement("script");return r.src=t,Object.keys(e).forEach((function(t){r.setAttribute(t,e[t]),"data-csp-nonce"===t&&r.setAttribute("nonce",e["data-csp-nonce"])})),r}function a(t,e){if(void 0===e&&(e=i()),s(t,e),"undefined"==typeof window)return e.resolve(null);var r=function(t){var e="https://www.paypal.com/sdk/js";t.sdkBaseURL&&(e=t.sdkBaseURL,delete t.sdkBaseURL),function(t){var e=t["merchant-id"],r=t["data-merchant-id"],n="",a="";Array.isArray(e)?e.length>1?(n="*",a=e.toString()):n=e.toString():"string"==typeof e&&e.length>0?n=e:"string"==typeof r&&r.length>0&&(n="*",a=r),t["merchant-id"]=n,t["data-merchant-id"]=a}(t);var r,n,a=Object.keys(t).filter((function(e){return void 0!==t[e]&&null!==t[e]&&""!==t[e]})).reduce((function(e,r){var n=t[r].toString();return"data-"===r.substring(0,5)?e.dataAttributes[r]=n:e.queryParams[r]=n,e}),{queryParams:{},dataAttributes:{}}),i=a.queryParams,o=a.dataAttributes;return{url:"".concat(e,"?").concat((r=i,n="",Object.keys(r).forEach((function(t){0!==n.length&&(n+="&"),n+=t+"="+r[t]})),n)),dataAttributes:o}}(t),a=r.url,c=r.dataAttributes,l=c["data-namespace"]||"paypal",d=o(l);return function(t,e){var r=document.querySelector('script[src="'.concat(t,'"]'));if(null===r)return null;var a=n(t,e),i=r.cloneNode();if(delete i.dataset.uidAuto,Object.keys(i.dataset).length!==Object.keys(a.dataset).length)return null;var o=!0;return Object.keys(i.dataset).forEach((function(t){i.dataset[t]!==a.dataset[t]&&(o=!1)})),o?r:null}(a,c)&&d?e.resolve(d):function(t,e){void 0===e&&(e=i()),s(t,e);var r=t.url,a=t.attributes;if("string"!=typeof r||0===r.length)throw new Error("Invalid url.");if(void 0!==a&&"object"!=typeof a)throw new Error("Expected attributes to be an object.");return new e((function(t,e){if("undefined"==typeof window)return t();!function(t){var e=t.onSuccess,r=t.onError,a=n(t.url,t.attributes);a.onerror=r,a.onload=e,document.head.insertBefore(a,document.head.firstElementChild)}({url:r,attributes:a,onSuccess:function(){return t()},onError:function(){var t=new Error('The script "'.concat(r,'" failed to load.'));return window.fetch?fetch(r).then((function(r){return 200===r.status&&e(t),r.text()})).then((function(t){var r=function(t){var e=t.split("/* Original Error:")[1];return e?e.replace(/\n/g,"").replace("*/","").trim():t}(t);e(new Error(r))})).catch((function(t){e(t)})):e(t)}})}))}({url:a,attributes:c},e).then((function(){var t=o(l);if(t)return t;throw new Error("The window.".concat(l," global variable is not available."))}))}function i(){if("undefined"==typeof Promise)throw new Error("Promise is undefined. To resolve the issue, use a Promise polyfill.");return Promise}function o(t){return window[t]}function s(t,e){if("object"!=typeof t||null===t)throw new Error("Expected an options object.");if(void 0!==e&&"function"!=typeof e)throw new Error("Expected PromisePonyfill to be a function.")}r.d(e,{g:()=>c,l:()=>a});const c=({clientId:t,reusable:e,merchantId:r,currency:n="usd",merchantInitiated:a})=>({"client-id":t.replace(/ /g,""),...!e||a?{"merchant-id":r.replace(/ /g,"")}:{},commit:!1,intent:e?"tokenize":"capture",vault:!0,currency:n?n.toUpperCase():"USD"})},49:(t,e,r)=>{r.r(e),r.d(e,{sc_paypal_add_method:()=>s});var n=r(4589),a=r(4388),i=r(3659),o=r(9964);r(857);const s=class{constructor(t){(0,n.r)(this,t),this.liveMode=!0,this.customerId=void 0,this.successUrl=void 0,this.currency=void 0,this.loading=void 0,this.loaded=void 0,this.error=void 0,this.paymentIntent=void 0}componentWillLoad(){this.createPaymentIntent()}async handlePaymentIntentCreate(){var t,e;const{external_intent_id:r}=this.paymentIntent||{},{client_id:n,account_id:s,merchant_initiated:c}=(null===(e=null===(t=this.paymentIntent)||void 0===t?void 0:t.processor_data)||void 0===e?void 0:e.paypal)||{};if(n&&s&&r&&!this.paypal)try{this.paypal=await(0,a.l)((0,a.g)({clientId:n,merchantId:s,merchantInitiated:c,reusable:!0})),this.paypal.Buttons({onInit:()=>{this.loaded=!0},createBillingAgreement:()=>new Promise((t=>t(r))),onApprove:async()=>{var t;try{this.loading=!0;const e=await(0,o.a)({method:"PATCH",path:`surecart/v1/payment_intents/${null===(t=this.paymentIntent)||void 0===t?void 0:t.id}/capture`});if(!["succeeded","pending","requires_approval"].includes(null==e?void 0:e.status))throw{message:(0,i._)("The payment did not process. Please try again.","surecart")};window.location.assign(this.successUrl)}catch(t){console.error(t),this.error=(null==t?void 0:t.message)||(0,i._)("The payment did not process. Please try again.","surecart"),this.loading=!1}},onError:t=>{console.error(t),alert((null==t?void 0:t.message)||(0,i._)("The payment did not process. Please try again.","surecart"))}}).render(this.container)}catch(t){console.error("Failed to load the PayPal JS SDK script",t),this.error=(0,i._)("Failed to load the PayPal JS SDK script","surecart")}}async createPaymentIntent(){var t,e;try{this.loading=!0,this.error="",this.paymentIntent=await(0,o.a)({method:"POST",path:"surecart/v1/payment_intents",data:{processor_type:"paypal",reusable:!0,live_mode:this.liveMode,customer_id:this.customerId,currency:this.currency,refresh_status:!0}})}catch(r){this.error=(null===(e=null===(t=null==r?void 0:r.additional_errors)||void 0===t?void 0:t[0])||void 0===e?void 0:e.message)||(null==r?void 0:r.message)||(0,i._)("Something went wrong","surecart")}finally{this.loading=!1}}render(){return(0,n.h)(n.H,null,this.error&&(0,n.h)("sc-alert",{open:!!this.error,type:"danger"},(0,n.h)("span",{slot:"title"},(0,i._)("Error","surecart")),this.error),(0,n.h)("div",{class:"sc-paypal-button-container",hidden:!this.loaded,ref:t=>this.container=t}))}static get watchers(){return{paymentIntent:["handlePaymentIntentCreate"]}}};s.style=':host{display:block}.paypal-buttons{position:relative;line-height:0;text-align:center}.paypal-buttons:after{content:" ";border-bottom:1px solid var(--sc-input-border-color);width:100%;height:0;top:50%;left:0;right:0;position:absolute}'}}]);