"use strict";(globalThis.webpackChunksuremembers=globalThis.webpackChunksuremembers||[]).push([[1620],{503:(e,t,i)=>{i.d(t,{o:()=>o});var n=i(4589),o=function(e,t,i){void 0===i&&(i=!0);var o="Function"===e.constructor.name?e.prototype:e,d=o.componentWillLoad;o.componentWillLoad=function(){var e,o=this,a=(0,n.a)(this),r={promise:new Promise((function(t){e=t})),resolve:e},s=new CustomEvent("openWormhole",{bubbles:!0,composed:!0,detail:{consumer:this,fields:t,updater:function(e,t){(e in a?a:o)[e]=t},onOpen:r}});a.dispatchEvent(s);var l=function(){if(d)return d.call(o)};return i?r.promise.then((function(){return l()})):l()}}},3524:(e,t,i)=>{i.d(t,{a:()=>_,b:()=>s,c:()=>h,d:()=>m,e:()=>l,f:()=>y,g:()=>v,r:()=>f,u:()=>g});var n=i(1874),o=i(9964),d=i(3659),a=i(2538),r=i(5792);const s="surecart/v1/checkouts/",l=["line_items","line_item.price","line_item.fees","line_item.variant","variant.image","price.product","product.featured_product_media","product.product_collections","product_media.media","customer","customer.shipping_address","payment_intent","discount","discount.promotion","recommended_bumps","bump.price","current_upsell","product.variants","discount.coupon","shipping_address","tax_identifier","manual_payment_method","shipping_choices","shipping_choice.shipping_method"],u=(e={})=>{var t,i,o,d,a,r;return{live_mode:"test"!==n.s.mode,group_key:n.s.groupId,abandoned_checkout_enabled:n.s.abandonedCheckoutEnabled,metadata:{...(null==e?void 0:e.metadata)||{},...(null===(t=null===window||void 0===window?void 0:window.scData)||void 0===t?void 0:t.page_id)&&{page_id:null===(i=null===window||void 0===window?void 0:window.scData)||void 0===i?void 0:i.page_id},...(null===(o=null===n.s||void 0===n.s?void 0:n.s.product)||void 0===o?void 0:o.id)&&{buy_page_product_id:null===(d=null===n.s||void 0===n.s?void 0:n.s.product)||void 0===d?void 0:d.id},page_url:window.location.href},...(null===(a=null===n.s||void 0===n.s?void 0:n.s.checkout)||void 0===a?void 0:a.email)&&{email:null===(r=null===n.s||void 0===n.s?void 0:n.s.checkout)||void 0===r?void 0:r.email},...e}},c=(e={})=>{var t,i;return{...!!(null===n.s||void 0===n.s?void 0:n.s.formId)&&{form_id:null===n.s||void 0===n.s?void 0:n.s.formId},...!!(null===(t=null===n.s||void 0===n.s?void 0:n.s.product)||void 0===t?void 0:t.id)&&{product_id:null===(i=null===n.s||void 0===n.s?void 0:n.s.product)||void 0===i?void 0:i.id},...e}},p=(e,t="")=>{let i=e?`${s}${e}`:s;return i=`${i}${t}`,(0,a.a)(i,{expand:l})},v=async({id:e,query:t={}})=>await(0,o.a)({path:(0,a.a)(p(e),c(t))}),h=async({id:e=null,data:t={},query:i={}})=>{var d,s;return e=e||(0,r.g)(window.location.href,"checkout_id")||((null===(d=null===n.s||void 0===n.s?void 0:n.s.checkout)||void 0===d?void 0:d.id)?null===(s=null===n.s||void 0===n.s?void 0:n.s.checkout)||void 0===s?void 0:s.id:null),await(0,o.a)({method:e?"PATCH":"POST",path:(0,a.a)(p(e),c(i)),data:u(t)})},m=async({id:e,data:t={},query:i={}})=>await(0,o.a)({method:"PATCH",path:(0,a.a)(p(e),c(i)),data:u(t)}),y=async({id:e,data:t={},query:i={},processor:n})=>await(0,o.a)({method:"POST",path:(0,a.a)(p(e,"/finalize"),c({...(null==n?void 0:n.manual)?{manual_payment:!0,manual_payment_method_id:null==n?void 0:n.id}:{processor_type:null==n?void 0:n.id},...i})),data:u(t)}),_=async({checkout:e,data:t,live_mode:i=!1})=>{var n;const d=((null===(n=null==e?void 0:e.line_items)||void 0===n?void 0:n.data)||[]).find((e=>{var i;return(null===(i=null==e?void 0:e.variant)||void 0===i?void 0:i.id)?e.variant.id===t.variant&&e.price.id===t.price:e.price.id===t.price}));if(!(null==e?void 0:e.id))return await(0,o.a)({method:"POST",path:(0,a.a)(p(null)),data:{line_items:[t],live_mode:i}});if(d)return await g({id:null==d?void 0:d.id,data:{...t,quantity:(null==d?void 0:d.quantity)+(null==t?void 0:t.quantity)}});const r=await(0,o.a)({path:(0,a.a)(`surecart/v1/line_items/${(null==d?void 0:d.id)?null==d?void 0:d.id:""}`,{consolidate:!0,expand:[...(l||[]).map((e=>e.includes(".")?e:`checkout.${e}`)),"checkout"]}),method:"POST",data:{...t,checkout:e.id}});return null==r?void 0:r.checkout},f=async({checkoutId:e,itemId:t})=>{const{deleted:i}=await(0,o.a)({path:`surecart/v1/line_items/${t}`,method:"DELETE"});if(!i)throw{code:"error",message:(0,d._)("Failed to delete","surecart")};return await v({id:e})},g=async({id:e,data:t})=>{const i=await(0,o.a)({path:(0,a.a)(`surecart/v1/line_items/${e}`,{expand:[...(l||[]).map((e=>e.includes(".")?e:`checkout.${e}`)),"checkout"]}),method:"PATCH",data:t});return null==i?void 0:i.checkout}},5444:(e,t,i)=>{i.d(t,{a:()=>h,c:()=>v,r:()=>m,s:()=>a});var n=i(3659),o=i(8445);const d=(0,i(2574).c)({type:"default",code:"",message:"",data:{status:0,type:"",http_status:""},additional_errors:[],dismissible:!1},((e,t)=>JSON.stringify(e)!==JSON.stringify(t))),{state:a,onChange:r,on:s,dispose:l,forceUpdate:u}=d,c={dismissible:!1},p=(e,t,i=c)=>{"string"==typeof t&&(t={type:e,message:t,code:""}),(null==t?void 0:t.message)||(t.message=(0,n._)("Something went wrong. Please try again.","surecart")),a.type=e,t={...i,...t},(0,o.s)(t.message,"assertive"),Object.keys(t).forEach((e=>{a[e]=t[e]}))},v=(e,t=c)=>{p("error",e,t)},h=(e,t=c)=>{p("info",e,t)},m=()=>{a.type="default",a.code="",a.message="",a.data={status:0,type:"",http_status:""},a.additional_errors=[]}},9038:(e,t,i)=>{i.d(t,{p:()=>n});var n=(0,i(3659).c)((function(e,t){function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0});var n,o="https://js.stripe.com/v3",d=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,a="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",r=null,s=function(e){return null!==r||(r=new Promise((function(t,i){if("undefined"!=typeof window)if(window.Stripe&&e&&console.warn(a),window.Stripe)t(window.Stripe);else try{var n=function(){for(var e=document.querySelectorAll('script[src^="'.concat(o,'"]')),t=0;t<e.length;t++){var i=e[t];if(d.test(i.src))return i}return null}();n&&e?console.warn(a):n||(n=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",i=document.createElement("script");i.src="".concat(o).concat(t);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(i),i}(e)),n.addEventListener("load",(function(){window.Stripe?t(window.Stripe):i(new Error("Stripe.js not available"))})),n.addEventListener("error",(function(){i(new Error("Failed to load Stripe.js"))}))}catch(e){return void i(e)}else t(null)}))),r},l=function(e,t,i){if(null===e)return null;var n=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.32.0",startTime:t})}(n,i),n},u=!1,c=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];u=!0;var o=Date.now();return s(n).then((function(e){return l(e,t,o)}))};c.setLoadParameters=function(e){if(u)throw new Error("You cannot change load parameters after calling loadStripe");n=function(e){var t="invalid load parameters; expected object of shape\n\n    {advancedFraudSignals: boolean}\n\nbut received\n\n    ".concat(JSON.stringify(e),"\n");if(null===e||"object"!==i(e))throw new Error(t);if(1===Object.keys(e).length&&"boolean"==typeof e.advancedFraudSignals)return e;throw new Error(t)}(e)},t.loadStripe=c}))},1620:(e,t,i)=>{i.r(t),i.d(t,{sc_stripe_payment_request:()=>u});var n=i(4589),o=i(9038),d=i(3659),a=i(1874),r=i(3524),s=i(5444),l=i(503);i(857),i(2574),i(8445),i(7808),i(9964);const u=class{constructor(e){(0,n.r)(this,e),this.scFormSubmit=(0,n.c)(this,"scFormSubmit",7),this.scPaid=(0,n.c)(this,"scPaid",7),this.scPayError=(0,n.c)(this,"scPayError",7),this.scSetState=(0,n.c)(this,"scSetState",7),this.scPaymentRequestLoaded=(0,n.c)(this,"scPaymentRequestLoaded",7),this.scUpdateOrderState=(0,n.c)(this,"scUpdateOrderState",7),this.stripeAccountId=void 0,this.publishableKey=void 0,this.country="US",this.prices=void 0,this.label="total",this.amount=0,this.theme="dark",this.error=void 0,this.debug=!1,this.loaded=!1,this.debugError=void 0}async componentWillLoad(){if(!(null==this?void 0:this.publishableKey)||!(null==this?void 0:this.stripeAccountId))return!0;try{this.stripe=await o.p.loadStripe(this.publishableKey,{stripeAccount:this.stripeAccountId}),this.elements=this.stripe.elements(),this.paymentRequest=this.stripe.paymentRequest({country:this.country,requestShipping:!0,requestPayerEmail:!0,shippingOptions:[{id:"free",label:"Free Shipping",detail:"No shipping required",amount:0}],...this.getRequestObject(null===a.s||void 0===a.s?void 0:a.s.checkout)})}catch(e){console.log((null==e?void 0:e.message)||(0,d._)("Stripe could not be loaded","surecart"))}}handleOrderChange(){this.paymentRequest&&(this.pendingEvent||this.paymentRequest.update(this.getRequestObject(null===a.s||void 0===a.s?void 0:a.s.checkout)))}handleLoaded(){this.scPaymentRequestLoaded.emit(!0)}handleErrorChange(){this.pendingEvent&&this.pendingEvent.complete("error")}async handleShippingChange(e){var t,i,n,o,s;const{shippingAddress:l,updateWith:u}=e;try{const e=await(0,r.c)({id:null===(t=null===a.s||void 0===a.s?void 0:a.s.checkout)||void 0===t?void 0:t.id,data:{shipping_address:{...(null==l?void 0:l.name)?{name:null==l?void 0:l.name}:{},...(null===(i=null==l?void 0:l.addressLine)||void 0===i?void 0:i[0])?{line_1:null===(n=null==l?void 0:l.addressLine)||void 0===n?void 0:n[0]}:{},...(null===(o=null==l?void 0:l.addressLine)||void 0===o?void 0:o[1])?{line_2:null===(s=null==l?void 0:l.addressLine)||void 0===s?void 0:s[1]}:{},...(null==l?void 0:l.city)?{city:null==l?void 0:l.city}:{},...(null==l?void 0:l.country)?{country:null==l?void 0:l.country}:{},...(null==l?void 0:l.postalCode)?{postal_code:null==l?void 0:l.postalCode}:{},...(null==l?void 0:l.region)?{state:null==l?void 0:l.region}:{}}}});u({status:"success",total:{amount:(null==e?void 0:e.amount_due)||0,label:(0,d._)("Total","surecart"),pending:!0}})}catch(e){e.updateWith({status:"invalid_shipping_address"})}}getName(e){var t,i,n,o,d;let a="";return a=Object.keys(this.prices||{}).filter((t=>this.prices[t].product===e.price.product.id)).length>1?`${null===(i=null===(t=null==e?void 0:e.price)||void 0===t?void 0:t.product)||void 0===i?void 0:i.name} – ${null===(n=null==e?void 0:e.price)||void 0===n?void 0:n.name}`:null===(d=null===(o=null==e?void 0:e.price)||void 0===o?void 0:o.product)||void 0===d?void 0:d.name,a}getRequestObject(e){var t;const i=((null===(t=null==e?void 0:e.line_items)||void 0===t?void 0:t.data)||[]).map((e=>({label:this.getName(e),amount:null!==e.ad_hoc_amount?e.ad_hoc_amount:e.subtotal_amount})));return{currency:a.s.currencyCode,total:{amount:(null==e?void 0:e.amount_due)||0,label:(0,d._)("Total","surecart"),pending:!0},displayItems:i}}componentDidLoad(){if(this.handleOrderChange(),this.removeCheckoutListener=(0,a.o)("checkout",(()=>this.handleOrderChange())),!this.elements)return;const e=this.elements.create("paymentRequestButton",{paymentRequest:this.paymentRequest,style:{paymentRequestButton:{theme:this.theme}}});this.paymentRequest.on("paymentmethod",(e=>this.handlePaymentMethod(e))),this.paymentRequest.on("shippingaddresschange",(async e=>await this.handleShippingChange(e))),this.paymentRequest.canMakePayment().then((t=>{t?(e.mount(this.request),this.loaded=!0):"https:"!==location.protocol?(this.debug&&(this.debugError=(0,d._)("You must serve this page over HTTPS to display express payment buttons.","surecart")),console.log("SSL needed to display payment buttons.")):(this.debug&&(this.debugError=(0,d._)("You do not have any wallets set up in your browser.","surecart")),console.log("No wallets available."))})).catch((e=>{console.error(e)}))}async handlePaymentMethod(e){var t,i,n,o,d;const{billing_details:l}=null==e?void 0:e.paymentMethod,{shippingAddress:u}=e;try{this.scSetState.emit("FINALIZE"),await(0,r.c)({id:null===(t=null===a.s||void 0===a.s?void 0:a.s.checkout)||void 0===t?void 0:t.id,data:{email:null==l?void 0:l.email,name:null==l?void 0:l.name,shipping_address:{...(null==u?void 0:u.name)?{name:null==u?void 0:u.name}:{},...(null===(i=null==u?void 0:u.addressLine)||void 0===i?void 0:i[0])?{line_1:null===(n=null==u?void 0:u.addressLine)||void 0===n?void 0:n[0]}:{},...(null===(o=null==u?void 0:u.addressLine)||void 0===o?void 0:o[1])?{line_2:null===(d=null==u?void 0:u.addressLine)||void 0===d?void 0:d[1]}:{},...(null==u?void 0:u.city)?{city:null==u?void 0:u.city}:{},...(null==u?void 0:u.country)?{country:null==u?void 0:u.country}:{},...(null==u?void 0:u.postalCode)?{postal_code:null==u?void 0:u.postalCode}:{},...(null==u?void 0:u.region)?{state:null==u?void 0:u.region}:{}}}});const s=await(0,r.f)({id:null===a.s||void 0===a.s?void 0:a.s.checkout.id,query:{form_id:a.s.formId},processor:{id:"stripe",manual:!1}});this.scSetState.emit("PAYING"),await this.confirmPayment(s,e),this.scSetState.emit("PAID"),this.scPaid.emit(),e.complete("success")}catch(t){console.error(t),this.scPayError.emit(t),(0,s.c)(t),e.complete("fail")}finally{this.confirming=!1}}async confirmPayment(e,t){var i,n,o,d,a,r,s,l,u,c,p,v,h,m,y,_,f,g;if("finalized"!==(null==e?void 0:e.status))return;if(!(null===(o=null===(n=null===(i=null==e?void 0:e.payment_intent)||void 0===i?void 0:i.processor_data)||void 0===n?void 0:n.stripe)||void 0===o?void 0:o.client_secret))return;if(!(null===(r=null===(a=null===(d=null==e?void 0:e.payment_intent)||void 0===d?void 0:d.processor_data)||void 0===a?void 0:a.stripe)||void 0===r?void 0:r.type))return;if(!(null===(s=null==e?void 0:e.payment_intent)||void 0===s?void 0:s.external_intent_id))return;if(this.confirming)return;let b;if(this.confirming=!0,b="setup"==(null===(c=null===(u=null===(l=null==e?void 0:e.payment_intent)||void 0===l?void 0:l.processor_data)||void 0===u?void 0:u.stripe)||void 0===c?void 0:c.type)?await this.confirmCardSetup(null===(v=null===(p=null==e?void 0:e.payment_intent)||void 0===p?void 0:p.processor_data)||void 0===v?void 0:v.stripe.client_secret,t):await this.confirmCardPayment(null===(m=null===(h=null==e?void 0:e.payment_intent)||void 0===h?void 0:h.processor_data)||void 0===m?void 0:m.stripe.client_secret,t),null==b?void 0:b.error)throw b.error;if("requires_action"===(null===(y=null==b?void 0:b.paymentIntent)||void 0===y?void 0:y.status)||"requires_source_action"===(null===(_=null==b?void 0:b.paymentIntent)||void 0===_?void 0:_.status)){const t=await this.stripe.confirmCardPayment(null===(g=null===(f=null==e?void 0:e.payment_intent)||void 0===f?void 0:f.processor_data)||void 0===g?void 0:g.stripe.client_secret);if(t.error)throw t.error;return t}return b}confirmCardPayment(e,t){return this.stripe.confirmCardPayment(e,{payment_method:t.paymentMethod.id},{handleActions:!1})}confirmCardSetup(e,t){return this.stripe.confirmCardSetup(e,{payment_method:t.paymentMethod.id},{handleActions:!1})}disconnectedCallback(){this.removeCheckoutListener()}render(){return(0,n.h)("div",{class:{request:!0,"request--loaded":this.loaded}},this.debug&&this.debugError&&(0,n.h)("div",null,(0,n.h)("slot",{name:"debug-fallback"}),(0,n.h)("sc-alert",{type:"info",open:!0},(0,n.h)("span",{slot:"title"},(0,d._)("Express Payment","surecart")),this.debugError)),(0,n.h)("div",{class:"sc-payment-request-button",part:"button",ref:e=>this.request=e}))}get el(){return(0,n.a)(this)}static get watchers(){return{loaded:["handleLoaded"],error:["handleErrorChange"]}}};(0,l.o)(u,["prices"],!1),u.style=":host{display:block}.or{display:none;margin:var(--sc-form-section-spacing) 0}.request--loaded .or{display:block}"}}]);