"use strict";(globalThis.webpackChunksuremembers=globalThis.webpackChunksuremembers||[]).push([[5581],{7231:(t,s,e)=>{e.d(s,{o:()=>a});const a=(t,s)=>{new window.IntersectionObserver(((t,e)=>{t[0].intersectionRatio>0&&(s(),e.unobserve(t[0].target))})).observe(t)}},5581:(t,s,e)=>{e.r(s),e.d(s,{sc_dashboard_downloads_list:()=>n});var a=e(4589),i=e(3659),o=e(9964),r=e(7231),h=e(2538);e(857);const n=class{constructor(t){(0,a.r)(this,t),this.query={page:1,per_page:10},this.allLink=void 0,this.heading=void 0,this.isCustomer=void 0,this.requestNonce=void 0,this.purchases=[],this.loading=void 0,this.busy=void 0,this.error=void 0,this.pagination={total:0,total_pages:0}}componentWillLoad(){(0,r.o)(this.el,(()=>{this.initialFetch()}))}async initialFetch(){if(this.isCustomer)try{this.loading=!0,await this.getItems()}catch(t){console.error(this.error),this.error=(null==t?void 0:t.message)||(0,i._)("Something went wrong","surecart")}finally{this.loading=!1}}async fetchItems(){if(this.isCustomer)try{this.busy=!0,await this.getItems()}catch(t){console.error(this.error),this.error=(null==t?void 0:t.message)||(0,i._)("Something went wrong","surecart")}finally{this.busy=!1}}async getItems(){const t=await await(0,o.a)({path:(0,h.a)("surecart/v1/purchases/",{expand:["product","product.downloads","download.media"],downloadable:!0,revoked:!1,...this.query}),parse:!1});return this.pagination={total:parseInt(t.headers.get("X-WP-Total")),total_pages:parseInt(t.headers.get("X-WP-TotalPages"))},this.purchases=await t.json(),this.purchases}nextPage(){this.query.page=this.query.page+1,this.fetchItems()}prevPage(){this.query.page=this.query.page-1,this.fetchItems()}render(){var t;return(0,a.h)("sc-purchase-downloads-list",{heading:this.heading,allLink:this.allLink&&this.pagination.total_pages>1?this.allLink:"",loading:this.loading,busy:this.busy,requestNonce:this.requestNonce,error:this.error,purchases:this.purchases},(0,a.h)("span",{slot:"heading"},(0,a.h)("slot",{name:"heading"},this.heading||(0,i._)("Downloads","surecart"))),(0,a.h)("sc-pagination",{slot:"after",page:this.query.page,perPage:this.query.per_page,total:this.pagination.total,totalPages:this.pagination.total_pages,totalShowing:null===(t=null==this?void 0:this.purchases)||void 0===t?void 0:t.length,onScNextPage:()=>this.nextPage(),onScPrevPage:()=>this.prevPage()}))}get el(){return(0,a.a)(this)}};n.style=":host{display:block}.download__details{opacity:0.75}"}}]);