"use strict";(globalThis.webpackChunksuremembers=globalThis.webpackChunksuremembers||[]).push([[2789],{7231:(t,e,i)=>{i.d(e,{o:()=>s});const s=(t,e)=>{new window.IntersectionObserver(((t,i)=>{t[0].intersectionRatio>0&&(e(),i.unobserve(t[0].target))})).observe(t)}},5108:(t,e,i)=>{i.r(e),i.d(e,{sc_subscription_payment_method:()=>a});var s=i(4589),o=i(3659),n=i(9964),r=i(7231),d=i(2538);i(857);const a=class{constructor(t){(0,s.r)(this,t),this.heading=void 0,this.subscription=void 0,this.paymentMethods=void 0,this.error=void 0,this.loading=void 0,this.busy=void 0,this.method=void 0}renderLoading(){return(0,s.h)("sc-card",{noPadding:!0},(0,s.h)("sc-stacked-list",null,(0,s.h)("sc-stacked-list-row",{style:{"--columns":"4"},"mobile-size":500},[...Array(4)].map((()=>(0,s.h)("sc-skeleton",{style:{width:"100px",display:"inline-block"}}))))))}renderEmpty(){return(0,s.h)("slot",{name:"empty"},(0,s.h)("sc-card",null,(0,s.h)("sc-empty",{icon:"credit-card"},(0,o._)("You do not have any payment methods.","surecart"))))}componentWillLoad(){(0,r.o)(this.el,(()=>{this.getPaymentMethods()}))}async getPaymentMethods(){var t,e,i,s;if(null===(t=this.paymentMethods)||void 0===t?void 0:t.length)return;const n=(null===(i=null===(e=this.subscription)||void 0===e?void 0:e.customer)||void 0===i?void 0:i.id)||(null===(s=this.subscription)||void 0===s?void 0:s.customer);if(n)try{this.loading=!0,this.paymentMethods=await this.fetchMethods(n)}catch(t){this.error=(null==t?void 0:t.messsage)||(0,o._)("Something went wrong","surecart"),console.error(this.error)}finally{this.loading=!1}}async fetchMethods(t){var e;return await(0,n.a)({path:(0,d.a)("surecart/v1/payment_methods",{expand:["card","customer","billing_agreement","paypal_account","payment_instrument","bank_account"],customer_ids:[t],reusable:!0,live_mode:null===(e=this.subscription)||void 0===e?void 0:e.live_mode})})}async deleteMethod(t){if(confirm((0,o._)("Are you sure you want to remove this payment method?","surecart")))try{this.busy=!0,await(0,n.a)({path:`surecart/v1/payment_methods/${null==t?void 0:t.id}/detach`,method:"PATCH"}),this.paymentMethods=this.paymentMethods.filter((e=>e.id!==t.id))}catch(t){this.error=(null==t?void 0:t.messsage)||(0,o._)("Something went wrong","surecart"),console.error(this.error)}finally{this.busy=!1}}async updateMethod(t){var e,i,s,r;const{payment_method:d}=await t.target.getFormJson();if(d!==((null===(i=null===(e=this.subscription)||void 0===e?void 0:e.payment_method)||void 0===i?void 0:i.id)||(null===(s=this.subscription)||void 0===s?void 0:s.payment_method)))try{this.busy=!0,this.subscription=await(0,n.a)({path:`surecart/v1/subscriptions/${null===(r=this.subscription)||void 0===r?void 0:r.id}`,method:"PATCH",data:{payment_method:d}})}catch(t){this.error=(null==t?void 0:t.messsage)||(0,o._)("Something went wrong","surecart"),console.error(this.error)}finally{this.busy=!1}}renderContent(){var t,e,i;return this.loading?this.renderLoading():(null===(t=this.paymentMethods)||void 0===t?void 0:t.length)?(0,s.h)("sc-form",{onScSubmit:t=>this.updateMethod(t)},(0,s.h)("sc-choices",null,this.renderList()),(null===(e=this.paymentMethods)||void 0===e?void 0:e.length)>1?(0,s.h)("sc-button",{type:"primary",submit:!0,full:!0,size:"large",busy:this.busy,disabled:this.busy},(0,o._)("Update Payment Method","surecart")):(0,s.h)("sc-button",{type:"link",full:!0,href:(0,d.a)(window.location.href,{action:"create",model:"payment_method",...!1===(null===(i=this.subscription)||void 0===i?void 0:i.live_mode)?{live_mode:!1}:{},success_url:window.location.href})},(0,s.h)("sc-icon",{name:"plus",slot:"prefix"}),(0,o._)("Add New","surecart"))):this.renderEmpty()}renderList(){return this.paymentMethods.map((t=>{var e,i,n;const r=(null===(i=null===(e=this.subscription)||void 0===e?void 0:e.payment_method)||void 0===i?void 0:i.id)||(null===(n=this.subscription)||void 0===n?void 0:n.payment_method),{id:d,card:a,live_mode:h,paypal_account:l}=t;return(0,s.h)("sc-choice",{checked:r===d,name:"payment_method",value:d,required:!0},(0,s.h)("sc-flex",{justifyContent:"flex-start","align-items":"center"},(0,s.h)("sc-payment-method",{paymentMethod:t})," ",!h&&(0,s.h)("sc-tag",{type:"warning",size:"small"},(0,o._)("Test","surecart"))),(0,s.h)("div",{slot:"description"},!!(null==a?void 0:a.exp_month)&&(0,s.h)("span",null,(0,o._)("Exp.","surecart"),null==a?void 0:a.exp_month,"/",null==a?void 0:a.exp_year),!!l&&(null==l?void 0:l.email)),r===d&&(0,s.h)("sc-tag",{type:"info",slot:"price"},(0,o._)("Current Payment Method","surecart")))}))}render(){var t,e;return(0,s.h)("sc-dashboard-module",{heading:this.heading||(0,o._)("Update Payment Method","surecart"),class:"subscription",error:this.error},(null===(t=this.paymentMethods)||void 0===t?void 0:t.length)>1&&(0,s.h)("sc-button",{slot:"end",type:"link",href:(0,d.a)(window.location.href,{action:"create",model:"payment_method",...!1===(null===(e=this.subscription)||void 0===e?void 0:e.live_mode)?{live_mode:!1}:{},success_url:window.location.href})},(0,s.h)("sc-icon",{name:"plus",slot:"prefix"}),(0,o._)("Add New","surecart")),this.renderContent(),this.busy&&(0,s.h)("sc-block-ui",{spinner:!0}))}get el(){return(0,s.a)(this)}};a.style=":host{display:block}"}}]);