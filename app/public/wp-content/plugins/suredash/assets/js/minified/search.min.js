jQuery("document").ready(function(i){if(0===i("#portal-search-result-template").length)return;let e=i("#portal-search-result-template"),n=_.template(e.html()),p="#search-wrapper",h="#result-list",f="#search-results",u="#search-loading",m="#search-input",t=".portal-search-results-wrap",v="#pfd-search-recent-docs",C=".portal-helper",g=portal_search.end_point_error,y=".portal-error-results-wrap",w=i(m).data("remote-url"),s,b="",o=document.querySelector(m),r=i(".search_page").val(),k=new AbortController;function a(s=!0){let e="subtype[]=portal",t=[];if(void 0!==portal_search.post_type){let s=[];(t=portal_search.post_type.split(",")).forEach(e=>{s.push("subtype[]="+e.trim())}),e=s.join("&")}let o=i(m),r=i.trim(i(m).val()),a=r===i(o).val(),c=""!==r,l=i(p).data("number"),d=w+"/wp-json/wp/v2/search?"+e+"&search="+r+"&per_page="+l+"&orderby=relevance&order=asc";(a||c)&&(""===r?q(1):2===r.length&&(q(),i(".search-results-text, .no-search-results-text").removeClass("pf-docs-show").addClass("pf-docs-hide"),i(f).removeClass("pf-docs-hide"),i(".portal-helper").removeClass("pf-docs-hide").addClass("pf-docs-show")),3<=r.length)&&(i(f).addClass("pf-docs-hide"),i(v).removeClass("pf-docs-show").addClass("pf-docs-hide"),i(h).addClass("pf-docs-hide"),i(f).find(".no-search-results-text").addClass("pf-docs-hide"),i(y).text(""),i(u).removeClass("pf-docs-hide").addClass("pf-docs-show"),k&&k?.abort(),k=new AbortController,fetch(d,{signal:k?.signal}).then(e=>e.json()).then(e=>{i(h).children().remove(),i(h).removeClass("pf-docs-hide").removeClass("rs-full").addClass("rs-empty"),i(u).removeClass("pf-docs-show").addClass("pf-docs-hide"),i(".pf-svg-search").addClass("pf-docs-show").removeClass("pf-docs-hide"),b=0===e.length?(i(f).removeClass("pf-docs-hide").closest(p).addClass("pf-docs-no-results"),i(f).find(".no-search-results-text").removeClass("pf-docs-hide"),i(f).find(".search-results-text").addClass("pf-docs-hide"),i(C).removeClass("pf-docs-show").addClass("pf-docs-hide"),"fail"):(i(f).closest(p).removeClass("pf-docs-no-results"),i(f).find(".search-results-text").removeClass("pf-docs-hide"),i(f).find(".no-search-results-text").addClass("pf-docs-hide"),grouped_results=S(e,"subtype"),t.forEach(e=>{let s=e;"post"===e?s="Blog Posts":"portal"===e&&(s="Portal Space"),void 0!==grouped_results[e]&&0<grouped_results[e].length&&(i(h).append("<li class='list-heading'>"+s+"</li>"),i.each(grouped_results[e],function(e,s){i(h).append(n({post:s})).removeClass("rs-empty").addClass("rs-full")}))}),"pass"),i(f).parent().removeClass("pf-docs-hide").addClass("pf-docs-show"),!0===s&&T(r)}).finally(function(){i(document).trigger("after")}).catch(function(e){"AbortError"!==e.name&&(i(y).text(g),i(u).removeClass("pf-docs-show").addClass("pf-docs-hide"))}))}i(".portal-header-search-trigger").on("click",function(e){e.preventDefault(),e.stopPropagation(),document.body.classList.add("portal-search-enabled"),i(p).addClass("search-active"),i(t).addClass("pf-docs-show").removeClass("pf-docs-hide"),setTimeout(function(){document.querySelector(m)?.focus()},100)}),i(m).on("keyup",function(e){13===e.keyCode&&a(!1)}),i(m).on("click",function(){i(this).addClass("pfd-focused"),i(this).closest(p).addClass("search-active");var e=i.trim(i(this).val()).length;0===i(h).children().length?a(!1):i(t).addClass("pf-docs-show").removeClass("pf-docs-hide"),portal_search?.recent_items?.enabled&&(i(t).addClass("pf-docs-show").removeClass("pf-docs-hide"),0===e)&&i(v).removeClass("pf-docs-hide")}),i(".portal-search-container .pf-svg-search").on("click",function(){a(!1)}),i(m).on("keyup",function(e){13!==e.keyCode&&(clearTimeout(s),a(!1),s=setTimeout(function(){var e;e=i.trim(i(m).val()),""!==b&&3<=e.length&&T(e)},4e3))}),i(m).on("keydown",function(){clearTimeout(s)});let S=(e,t)=>e.reduce((e,s)=>((e[s[t]]=e[s[t]]||[]).push(s),e),{});function q(e=0){i(h).children().remove(),1===e&&i(m).val(""),i(f).removeClass("pf-docs-show").addClass("pf-docs-hide"),i(h).removeClass("rs-full").addClass("rs-empty"),i(C).removeClass("pf-docs-show").addClass("pf-docs-hide"),i(y).empty(),i(".pf-docs-after-wrapper").fadeOut();e=i.trim(i(m).val()).length;i(t).toggleClass("pf-docs-show",0!==e).toggleClass("pf-docs-hide",0===e),portal_search?.recent_items?.enabled&&(i(t).addClass("pf-docs-show").removeClass("pf-docs-hide"),i(v).toggleClass("pf-docs-hide",0!==e))}function T(e){i.ajax({url:portal_search.ajaxurl,type:"POST",dataType:"json",data:{action:"portal_search_result",search_term:e,request_status:b,page:r,security:portal_search.portal_search_result}}).fail(function(){}).done(function(){})}jQuery("body").click(function(e){jQuery(e.target).closest(".portal-search-results-wrap").length||"search-input"===e.target.id||(document.body.classList.remove("portal-search-enabled"),i(m).removeClass("pfd-focused"),i(m).closest(p).removeClass("search-active"),q())}),jQuery("body").click(function(e){jQuery(e.target).closest(".portal-search-results-wrap").length||"search-input"===e.target.id||(document.body.classList.remove("portal-search-enabled"),i(m).removeClass("pfd-focused"),i(m).closest(p).removeClass("search-active"),i(t).removeClass("pf-docs-show").addClass("pf-docs-hide"))}),o&&document.addEventListener("keydown",function(s){if("/"===s.key&&"INPUT"!==s.target.tagName&&"TEXTAREA"!==s.target.tagName&&(s.preventDefault(),document.body.classList.add("portal-search-enabled"),o?.classList.add("pfd-focused"),o?.closest(p)?.classList.add("search-active"),i(t).addClass("pf-docs-show").removeClass("pf-docs-hide"),setTimeout(function(){document.querySelector(m)?.focus()},100)),portal_search?.recent_items?.enabled&&"ArrowDown"===s.key)if(s.preventDefault(),s.target?.classList.contains("pf-docs-search-input")){var e=document.querySelector(v+":not(.pf-docs-hide) .portal-search-item-link, #result-list .portal-search-item-link");e&&e?.focus()}else{let e=s.target?.closest(".pfd-search-item")?.nextElementSibling?.querySelector(".portal-search-item-link");(e=e||document.querySelector(v+":not(.pf-docs-hide) .pfd-search-categories-container .pfd-search-item:last-child")?.id===s.target?.closest(".pfd-search-item")?.id?e:document.querySelector(v+":not(.pf-docs-hide) .pfd-search-categories-container .pfd-search-item .portal-search-item-link"))?.focus()}if(portal_search?.recent_items?.enabled&&"ArrowUp"===s.key&&s.target?.classList.contains("portal-search-item-link")){s.preventDefault();let e=s.target?.closest(".pfd-search-item")?.previousElementSibling?.querySelector(".portal-search-item-link");(e=e||document.querySelector(v+":not(.pf-docs-hide) .pfd-search-recent-docs-container .pfd-search-item")?.id===s.target?.closest(".pfd-search-item")?.id?e:document.querySelector(v+":not(.pf-docs-hide) .pfd-search-recent-docs-container .pfd-search-item:last-child .portal-search-item-link"))?e?.focus():setTimeout(function(){document.querySelector(m)?.focus()},100)}});document.querySelectorAll(".pfd-search-recent-item-remove")?.forEach(d=>{d?.addEventListener("click",t=>{t.stopPropagation();let o=d?.dataset?.id;if(o){let s=(e=>{if(2===(e=("; "+document.cookie).split(`; ${e}=`)).length)return e.pop().split(";").shift()})("portal_recently_viewed");if(s){var r,a,t=(s=s.split("portal").filter(e=>e!==o).join("portal"))?portal_search?.recent_doc?.cookie_duration||604800:-86400;{var c="portal_recently_viewed";var l=s;let e="";t&&(a=(r=new Date).getTime(),r.setTime(a+1e3*t),e="; expires="+r.toUTCString()),document.cookie=c+"="+(l||"")+e+"; path=/"}}let e=document.querySelectorAll('[id^="portal_search_item-"]').length;d.parentElement.style.opacity=0,e<=3&&(document.querySelector(".pfd-search-recent-docs-container").style.opacity=0),setTimeout(()=>{d?.parentElement.remove(),e<=3&&document.querySelector(".pfd-search-recent-docs-container")?.remove()},250)}})})});