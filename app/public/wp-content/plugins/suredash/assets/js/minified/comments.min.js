let joditIcons={bold:`<svg class="custom-jodit-icons tooltip-trigger" data-tooltip-title="${portal_global.jodit_messages.bold_tooltip}" data-tooltip-position="top" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8"/></svg>`,italic:`<svg class="custom-jodit-icons tooltip-trigger" data-tooltip-title="${portal_global.jodit_messages.italic_tooltip}" data-tooltip-position="top" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-italic"><line x1="19" x2="10" y1="4" y2="4"></line><line x1="14" x2="5" y1="20" y2="20"></line><line x1="15" x2="9" y1="4" y2="20"></line></svg>`,underline:`<svg class="custom-jodit-icons tooltip-trigger" data-tooltip-title="${portal_global.jodit_messages.underline_tooltip}" data-tooltip-position="top" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-underline"><path d="M6 4v6a6 6 0 0 0 12 0V4"></path><line x1="4" x2="20" y1="20" y2="20"></line></svg>`,image:`<svg class="custom-jodit-icons tooltip-trigger" data-tooltip-title="${portal_global.jodit_messages.image_tooltip}" data-tooltip-position="top" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-image"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><circle cx="9" cy="9" r="2"></circle><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path></svg>`,video:`<svg class="custom-jodit-icons tooltip-trigger" data-tooltip-title="${portal_global.jodit_messages.video_tooltip}" data-tooltip-position="top" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-video"><path d="m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"></path><rect x="2" y="6" width="14" height="12" rx="2"></rect></svg>`,emoji:`<svg class="custom-jodit-icons tooltip-trigger" data-tooltip-title="${portal_global.jodit_messages.emoji_tooltip}" data-tooltip-position="top" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-smile"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" x2="9.01" y1="9" y2="9"></line><line x1="15" x2="15.01" y1="9" y2="9"></line></svg>`,tagUser:`<svg class="custom-jodit-icons tooltip-trigger" data-tooltip-title="${portal_global.jodit_messages.mention_tooltip}" data-tooltip-position="top" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-at-sign"><circle cx="12" cy="12" r="4"></circle><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8"></path></svg>`,giphy:`<svg class="custom-jodit-icons tooltip-trigger" data-tooltip-title="${portal_global.jodit_messages.gif_tooltip}" data-tooltip-position="top" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-image-play"><path d="m11 16-5 5"></path><path d="M11 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v6.5"></path><path d="M15.765 22a.5.5 0 0 1-.765-.424V13.38a.5.5 0 0 1 .765-.424l5.878 3.674a1 1 0 0 1 0 1.696z"></path><circle cx="9" cy="9" r="2"></circle></svg>`},initializeJoditCommentBoxes=()=>{Jodit.modules.Icon.set("bold",joditIcons.bold),Jodit.modules.Icon.set("italic",joditIcons.italic),Jodit.modules.Icon.set("underline",joditIcons.underline),Jodit.modules.Icon.set("image",joditIcons.image),Jodit.modules.Icon.set("video",joditIcons.video),Jodit.modules.Icon.set("emoji",joditIcons.emoji),Jodit.modules.Icon.set("tagUser",joditIcons.tagUser),Jodit.modules.Icon.set("giphy",joditIcons.giphy);var t=document.querySelectorAll(".jodit-comment");t&&t.forEach(t=>{!Jodit.instances[t.id]&&(portalMakeItJoditEditor({element:t}),t.closest(".comment-markup").classList.remove("sd-display-none"))})},handleReplyClick=t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var e,o,i,l,s=t.target.closest("article.portal-comment");s.querySelector(".comment-markup")||(o=s.closest(".portal-content"),l=s.getBoundingClientRect(),i=t.target.closest(".portal-comment-section").getBoundingClientRect(),e=s.querySelector(".portal-user-commenter").textContent.trim(),(o=o.querySelector(".hidden-comment-markup").cloneNode(!0)).classList.remove("hidden-comment-markup","sd-display-none","sd-w-full"),o.style.marginLeft=i.left-l.left+"px",i=t.target.closest(".portal-comment").id.split("-")[1],l=o.querySelector('input[name="comment_parent"]'),t=o.querySelector(".hidden-jodit-comment"),l&&(l.value=i),t&&(t.id=t.id+"-"+i),s.append(o),portalMakeItJoditEditor({element:t,autoFocus:!0,placeholder:portal_global?.comment_reply_box_placeholder+` ${e}...`}))},initializeNewJoditDesign=(t,e=null)=>{let o=t.container.querySelector(".jodit-toolbar__box"),i=t.container.querySelector(".jodit-workplace");var l=t.container.querySelector(".jodit-toolbar-editor-collection");i.style.padding="12px",o.classList.add("post-comment-options","hidden"),t.events.on("focus",()=>{o.classList.remove("hidden"),i.style.padding="12px"}),o&&i&&(i.parentNode.appendChild(o),setTimeout(()=>{var t=i.querySelector(".jodit-placeholder");t&&(t.textContent=e,t.style.paddingLeft="12px")},1)),l&&(l.style.display="flex",l.style.flexWrap="wrap",l.style.flexDirection="row",l.style.justifyContent="space-between",l.style.alignItems="center",l.style.paddingRight="8px",t=t.container.parentNode.querySelector(".post-comment-box-submit"))&&(t.style.marginLeft="auto",l.appendChild(t),l=i.closest("form"))&&l.addEventListener("submit",t=>{t.preventDefault(),submitComment(t)})},submitComment=async t=>{t.preventDefault(),t.stopPropagation();var t=t.currentTarget,e=t.closest("li"),o=t.querySelector(".post-comment-box-submit"),i=parseInt(t.querySelector('input[name="comment_parent"]')?.value||0),l=t.querySelector('[name="comment"]')||null,s=o.querySelector('.portal-svg-icon[aria-label="SendHorizontal"]'),a=o.querySelector('.portal-svg-icon[aria-label="LoaderCircle"]');if(o&&(o.disabled=!0,s.classList.add("sd-display-none"),a.classList.remove("sd-display-none")),l){var r=l.value.trim();if(!r||"<p><br></p>"===r)return portalPushNotification("info",portal_global?.notification_messages?.comment_invalid),void(o&&(o.disabled=!1,s.classList.remove("sd-display-none"),a.classList.add("sd-display-none")))}r=new FormData(t),r.append("depth",e?.dataset?.depth??0),e=Jodit.instances[l.id].getNativeEditorValue(),e=await handleBlobImages(e,r),r.set("comment",e),l=document.querySelector("#portal-post-reaction-modal");try{var n=await sdApiFetch("suredash/v1/submit-comment","POST",r);n.success?(addCommentMarkup(t,n.data.comment_html,i),clearCommentBox(t),l?.querySelector(".no-comments-message")?.remove()):handleError(n)}catch(t){var d=t?.message||portal_global?.notification_messages?.error_occurred;portalPushNotification("info",d,t.message.replace(/&#8217;/g,"'"))}finally{o&&(o.disabled=!1,s.classList.remove("sd-display-none"),a.classList.add("sd-display-none"))}},addCommentMarkup=(t,e,o)=>{0<o?t.parentNode.insertAdjacentHTML("beforebegin",`<div class="portal-replies-wrapper sd-mt-8"><ol class="children">${e}</ol></div>`):((o=t.closest(".portal-content").querySelector(".portal-comment-list")).insertAdjacentHTML("beforeend",e),e=o.lastElementChild,document.querySelector("#portal-post-reaction-modal")?.classList.contains("active")&&e.scrollIntoView({behavior:"smooth",block:"center"})),updateCommentsCount(t),document.dispatchEvent(new Event("suredashboard_global_recurring_trigger"))},updateCommentsCount=t=>{t=t.querySelector('[name="comment_post_ID"]')?.value||0;document.querySelectorAll("#portal-post-"+t).forEach(t=>{var e,t=t.querySelector(".portal-comments-count .counter");t&&(e=parseInt(t.innerText||0),t.innerText=e+1)})},clearCommentBox=t=>{var e,t=t.querySelector(".jodit-comment")||t.querySelector(".jodit-comment-outer")||t.querySelector(".hidden-jodit-comment");t&&((e=Jodit.instances[t.id])?(e.setEditorValue(""),e.events.fire("change")):t.value="")},handleError=t=>{var e;t?.data&&(console.error(t?.data),e=t?.data||portal_global?.notification_messages?.error_occurred,portalPushNotification("error",e,t.data.replace(/&#8217;/g,"'")))};