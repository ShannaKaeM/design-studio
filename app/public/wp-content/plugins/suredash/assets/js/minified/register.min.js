SureDashRegister={form:"",fields:"",settings:{},registerButtonInnerElement:"",spinner:`<svg width="20" height="20" viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg" stroke="#fff">
		<g fill="none" fill-rule="evenodd">
			<g transform="translate(1 1)" stroke-width="2">
				<circle stroke-opacity=".5" cx="18" cy="18" r="18"/>
				<path d="M36 18c0-9.94-8.06-18-18-18">
					<animateTransform
						attributeName="transform"
						type="rotate"
						from="0 18 18"
						to="360 18 18"
						dur="1s"
						repeatCount="indefinite"/>
				</path>
			</g>
		</g>
	</svg>`,classes:{inputError:"spectra-pro-register-form__input-error",inputSuccess:"spectra-pro-register-form__input-success",fieldErrorMessage:"spectra-pro-register-form__field-error-message"},init(e,t={}){this.settings=t,this.form=document.querySelector(e),this.form&&(this.fields=this.getFormFields(),this.validateOnEntry(),this.usernameAndEmailUniqueCheck(),t.reCaptchaEnable&&this.reCaptcha(t.reCaptchaType),t.enableGoogleLogin&&this.googleLogIn(t),t.enableFacebookLogin&&this.facebookLogIn(t),this.formSubmitInit(t.reCaptchaEnable,t.reCaptchaType))},_validateFields(e){if(e.required)switch(e.name){case"first_name":""===e.value.trim()?this._setStatus(e,`${e?.previousElementSibling?.innerText||"First Name"} cannot be blank`,"error"):this._setStatus(e,null,"success");break;case"last_name":""===e.value.trim()?this._setStatus(e,`${e?.previousElementSibling?.innerText||"Last Name"} cannot be blank`,"error"):this._setStatus(e,null,"success");break;case"username":""===e.value.trim()&&this._setStatus(e,SureDashRegister.settings.messageInvalidUsernameError,"error");break;case"email":""===e.value.trim()?this._setStatus(e,SureDashRegister.settings.messageEmailMissingError,"error"):""!==e.value.trim()&&(/\S+@\S+\.\S+/.test(e.value)?this._setStatus(e,null,"success"):this._setStatus(e,SureDashRegister.settings.messageInvalidEmailError,"error"));break;case"password":""===e.value.trim()?this._setStatus(e,SureDashRegister.settings.messageInvalidPasswordError,"error"):this._setStatus(e,null,"success");break;case"reenter_password":var t=SureDashRegister.form.querySelector('input[name="password"]');t.value&&(e.value!==t.value||""===e.value.trim()?this._setStatus(e,SureDashRegister.settings.messagePasswordConfirmError,"error"):this._setStatus(e,null,"success"));break;case"terms":e.checked?this._setStatus(e,null,"success"):this._setStatus(e,SureDashRegister.settings.messageTermsError,"error");break;default:""!==!e.value?this._setStatus(e,SureDashRegister.settings.messageOtherError,"error"):this._setStatus(e,null,"success")}},_setStatus(e,t,s,r=null){var a,i=e.parentElement.querySelector(".spectra-pro-register-form__field-success-message"),o=e.parentElement.querySelector(".spectra-pro-register-form__field-error-message");"success"===s&&(o&&(e.classList.remove(SureDashRegister.classes.inputError),o.remove()),e.classList.add(SureDashRegister.classes.inputSuccess),i?(i.innerHTML=t,r&&(i.style.color=r)):((a=document.createElement("span")).classList="spectra-pro-register-form__field-success-message",a.innerHTML=t,r&&(a.style.color=r),e.parentElement.appendChild(a))),"error"===s&&(e.classList.add(SureDashRegister.classes.inputError),i&&(e.classList.remove(SureDashRegister.classes.inputSuccess),i.remove()),o?o.innerHTML=t:((r=document.createElement("span")).classList="spectra-pro-register-form__field-error-message",r.innerHTML=t,e.parentElement.appendChild(r)))},_isFormSubmitable(){return SureDashRegister.form.getElementsByClassName(SureDashRegister.classes.inputError).length<1},_debounce(t,s=500){let r;return(...e)=>{clearTimeout(r),r=setTimeout(()=>{t.apply(this,e)},s)}},_clearValidationMessage(){SureDashRegister.form.querySelector(".spectra-pro-register-form__field-error-message").remove(),SureDashRegister.form.querySelector(".spectra-pro-register-form-status").remove()},_showValidationMessage(e){Object.entries(e).forEach(([e,t])=>{var s=document.createElement("span"),t=(s.classList="spectra-pro-register-form__field-error-message",s.innerHTML=t,SureDashRegister.form.querySelector('input[name="'+e+'"]'));t&&t.parentElement.append(s)})},reCaptcha(e){var t;"v2"===e&&SureDashRegister.settings.recaptchaSiteKey?((t=document.createElement("script")).type="text/javascript",t.src="https://www.google.com/recaptcha/api.js",document.head.appendChild(t)):"v3"===e&&SureDashRegister.settings.recaptchaSiteKey&&(SureDashRegister.settings.hidereCaptchaBatch&&(t=document.getElementsByClassName("grecaptcha-badge")[0])&&(t.style.visibility="hidden"),(e=document.createElement("script")).type="text/javascript",e.src="https://www.google.com/recaptcha/api.js?render="+SureDashRegister.settings.recaptchaSiteKey,document.head.appendChild(e))},getFormFields(){return SureDashRegister.form.getElementsByTagName("input")},validateOnEntry(){let s=this;Object.entries(this.fields).forEach(([,t])=>{"password"===t.type&&"password"===t.name&&t.addEventListener("keyup",e=>{s._checkPasswordStrength(t)}),t.addEventListener("focusout",e=>{s._validateFields(t)})})},_checkPasswordStrength(e){var t=e.value;let s;switch(s=SureDashRegister.settings.wp_version?wp.passwordStrength.meter(t,wp.passwordStrength.userInputDisallowedList(),t):wp.passwordStrength.meter(t,wp.passwordStrength.userInputBlacklist(),t)){case-1:this._setStatus(e,pwsL10n.unknown,"success","#cfcfcf");break;case 2:this._setStatus(e,pwsL10n.bad,"success","#e07757");break;case 3:this._setStatus(e,pwsL10n.good,"success","#f0ad4e");break;case 4:this._setStatus(e,pwsL10n.strong,"success","#5cb85c");break;case 5:this._setStatus(e,pwsL10n.mismatch,"success","#f0ad4e");break;default:this._setStatus(e,pwsL10n.short,"success","#d9534f")}},usernameAndEmailUniqueCheck(){let r=this;var e=this._debounce(async e=>{if(e.target.value){var t=new FormData;t.append("field_name",e.target.name),t.append("field_value",e.target.value);try{var s=await wp.apiFetch({path:"suredash/v1/register-unique-username-and-email",method:"POST",body:t});s.success&&("username"===e.target.name?r._setStatus(r.form.querySelector('input[name="username"]'),s.data?.has_error?SureDashRegister.settings[s.data?.attribute]:null,s.data?.has_error?"error":"success"):r._setStatus(r.form.querySelector('input[name="email"]'),s.data?.has_error?SureDashRegister.settings[s.data?.attribute]:null,s.data?.has_error?"error":"success"))}catch(e){console.error(e)}}});SureDashRegister.form.querySelector('input[name="username"]')?.addEventListener("keypress",e,!1),SureDashRegister.form.querySelector('input[name="username"]')?.addEventListener("focusout",e,!1),SureDashRegister.form.querySelector('input[name="email"]')?.addEventListener("keypress",e,!1),SureDashRegister.form.querySelector('input[name="email"]')?.addEventListener("focusout",e,!1)},formSubmitInit(t,s){this.form.addEventListener("submit",e=>{if(e.preventDefault(),!0===t)if("v3"===s){if(0===document.getElementsByClassName("grecaptcha-logo").length)return!(SureDashRegister.form.parentElement.querySelector(".spectra-pro-register-form-status").innerHTML='<div class="spectra-pro-register-form-status__error"><strong>Error:</strong> Invalid Google reCAPTCHA Site Key.</div>');grecaptcha.ready(function(){grecaptcha.execute(SureDashRegister.settings.recaptchaSiteKey,{action:"submit"}).then(function(e){SureDashRegister.formSubmit(e)})})}else SureDashRegister.formSubmit();else SureDashRegister.formSubmit()})},facebookLogIn(a){window.is_fb_loggedin=!1;let i=SureDashRegister.form.parentElement.querySelector(".spectra-pro-register-form-status"),t=document.querySelector("#spectra-pro-register-fbLink");var e,s,r;t&&(t.addEventListener("click",function(){is_fb_loggedin||FB.login(function(e){e.authResponse?FB.api("/me",{fields:"id, name, first_name, last_name, email, link, gender, locale, picture"},async function(e){var t=FB.getAuthResponse().userID,s=FB.getAuthResponse().accessToken,r=(window.is_fb_loggedin=!0,SureDashRegister._before_submit(),new FormData);r.append("post_id",a.post_id),r.append("block_id",a.block_id),r.append("facebook_user_id",t),r.append("facebook_access_token",s),r.append("facebook_name",e.name),r.append("facebook_first_name",e.first_name),r.append("facebook_last_name",e.last_name),r.append("facebook_email",e.email),r.append("facebook_link",e.link);try{let e=await wp.apiFetch({path:"suredash/v1/login-form-facebook",method:"POST",body:r});e.success?i.innerHTML=`<div class='spectra-pro-register-form-status__success'>${e.data?.message}</div>`:i.innerHTML=`<div class="spectra-pro-register-form-status__error">${e.data?.message}</div>`,setTimeout(()=>{SureDashRegister._after_submit(),!0===e.success&&(SureDashRegister.settings.afterRegisterActions?.includes("autoLogin")?SureDashRegister._dispatchLoginRedirect(e.data?.redirect_url):window.location.reload())},1e3)}catch(e){console.error(e)}}):i.innerHTML='<div class="spectra-pro-register-form-status__error"><strong>Error:</strong> User cancelled login or did not fully authorize.</div>'},{scope:"email"})}),window.fbAsyncInit=function(){var e=t.getAttribute("data-appid");FB.init({appId:e,cookie:!0,xfbml:!0,version:"v2.8"})},e=document,s="facebook-jssdk",r=e.getElementsByTagName("script")[0],e.getElementById(s)||((e=e.createElement("script")).id=s,e.src="//connect.facebook.net/en_US/sdk.js",r.parentNode.insertBefore(e,r)))},googleLogIn(t){window.is_google_loggedin=!1;let s=SureDashRegister.form.parentElement.querySelector(".spectra-pro-register-form-status"),r=document.querySelector("#spectra-pro-register-googleLink");if(r){let e=r.getAttribute("data-clientid");window.google.accounts.id.initialize({client_id:e,callback:e=>{SureDashRegister._before_submit(),this.handleGoogleRegister(e.credential,t,r,s)},auto_select:!0,cancel_on_tap_outside:!1,context:"signup"}),r.addEventListener("click",()=>{window.google.accounts.oauth2.initTokenClient({client_id:e,scope:"openid email profile https://www.googleapis.com/auth/drive.metadata.readonly https://www.googleapis.com/auth/calendar.readonly",callback:e=>{e.access_token?this.handleGoogleRegister(e.access_token,t,r,s):s.innerHTML='<div class="spectra-pro-register-form-status__error">Authorization failed. Please try again.</div>'},state:"custom_unique_state",include_granted_scopes:!0,prompt:"select_account"}).requestAccessToken()})}},async handleGoogleRegister(e,t,s,r){SureDashRegister.form.style.opacity="0.45",s.setAttribute("disabled","disabled"),SureDashRegister.loginButtonInnerElement=s.innerHTML;var a=new FormData;a.append("data",{send_email:!0}),a.append("id_token",e);try{var i=await wp.apiFetch({path:"suredash/v1/block-login",method:"POST",body:a});i.success||200===i?.status?(r.innerHTML=`<div class='spectra-pro-register-form-status__success'>${SureDashRegister.settings.loggedInMessage}</div>`,this._dispatchLoginRedirect(t?.redirect_url)):r.innerHTML=`<div class="spectra-pro-register-form-status__error">${i?.data?.error||i?.data?.message||"Unexpected error occurred."}</div>`}catch(e){console.error("Login error:",e),r.innerHTML='<div class="spectra-pro-register-form-status__error">An error occurred during login. Please try again.</div>'}SureDashRegister.form.style.opacity="1",s.removeAttribute("disabled")},_dispatchLoginRedirect(e){window.location.href=e},async formSubmit(s=!1){if(SureDashRegister._isFormSubmitable()){var r=SureDashRegister.form.parentElement.querySelector(".spectra-pro-register-form-status");let t=new FormData;var a=SureDashRegister.form.querySelector(".spectra-pro-register-form"),i=a,a=(i.elements=a.elements,t.append("post_id",SureDashRegister.settings.post_id),t.append("block_id",SureDashRegister.settings.block_id),Object.entries(i.elements).forEach(([,e])=>{e.name&&t.append(e.name,e.value)}),s&&t.append("g-recaptcha-response",s),SureDashRegister._before_submit(),SureDashRegister.form.querySelector("."+SureDashRegister.classes.fieldErrorMessage));a&&a.remove();let e=await wp.apiFetch({path:"suredash/v1/block-register",method:"POST",body:t});if(e.success)r.innerHTML="<div class='spectra-pro-register-form-status__success'>"+e.data?.message+"</div>";else{let t="";"object"==typeof e.data&&Object.entries(e.data).forEach(([,e])=>{t+="<div class='spectra-pro-register-form-status__error-item'>"+e+"</div>"}),r.innerHTML=t||"<div class='spectra-pro-register-form-status__error'>"+JSON.stringify(e.data)+"</div>"}setTimeout(()=>{SureDashRegister._after_submit(),e.success?SureDashRegister.settings.afterRegisterActions?.includes("redirect")?SureDashRegister._dispatchLoginRedirect(e.data?.redirect_url):window.location.reload():SureDashRegister._showValidationMessage(e.data)},1e3)}},_before_submit(){var e=SureDashRegister.form.querySelector(".spectra-pro-register-form__submit");e.setAttribute("disabled","disabled"),e.querySelector("svg")||(SureDashRegister.registerButtonInnerElement=e.innerHTML),e.innerHTML=SureDashRegister.spinner,e.style.opacity="0.45",SureDashRegister.form.parentElement.querySelector(".spectra-pro-register-form-status").innerHTML=""},_after_submit(){var e=SureDashRegister.form.querySelector(".spectra-pro-register-form__submit");e.removeAttribute("disabled"),e.innerHTML=SureDashRegister.registerButtonInnerElement,e.style.opacity="1"}};