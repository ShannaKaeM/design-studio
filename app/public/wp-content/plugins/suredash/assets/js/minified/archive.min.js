(()=>{async function t(e){e.preventDefault(),e.target.disabled=!0;var t=document.querySelectorAll(".portal_feed_input, #custom_post_content, #custom_post_title");let o={},r=!1;t.forEach(e=>{var t=e?.name||"",e=e?.value||"";"custom_post_cover_image"===t&&""!==e&&(r=!0),o[t]=e});var t=new FormData,a=o.custom_post_content||"",a=await handleBlobImages(a,t);o.custom_post_content=a,t.append("formData",JSON.stringify(o)),r&&t.append("custom_post_cover_image",document.querySelector('input[name="custom_post_cover_image"]').files[0]),t.has("formData")&&o.custom_post_content?((a=await sdApiFetch("suredash/v1/submit-topic","POST",t)).success?portalPushNotification("success",portal_global?.notification_messages?.post_submitted):portalPushNotification("error","",a.data.message),setTimeout(()=>{location.reload(),e.target.disabled=!1},1e3)):(portalPushNotification("error",portal_global?.notification_messages?.please_fill_required_fields),e.target.disabled=!1)}function o(e){e.preventDefault(),e.stopPropagation();e=e.currentTarget;e.classList.toggle("active"),e.parentElement.querySelector(".portal-post-sharing-wrapper")?.classList.toggle("active")}function n(){var t=document.querySelectorAll(".portal-post-share-trigger");for(let e=0;e<t.length;e++)t[e].addEventListener("click",o),t[e].addEventListener("mouseenter",e=>{e=e.currentTarget;e.classList.add("active"),e.parentElement.querySelector(".portal-post-sharing-wrapper")?.classList.add("active")});document.querySelector(".ast-quick-view-close-btn")?.addEventListener("click",r);var e=new CustomEvent("sureDashboardInitLightbox"),e=(document.dispatchEvent(e),new CustomEvent("suredashboard_global_recurring_trigger")),e=(document.dispatchEvent(e),document.querySelector("#comment"));e&&portalMakeItJoditEditor({element:e})}function l(){let e=document.querySelector("#portal-quick-view-modal"),t=e.querySelector("#portal-quick-view-content");var o,r,a;e&&!e.classList.contains("open")&&(o=t.outerHeight,r=window.innerHeight,a=document.querySelector("html"),r<o?a.style.marginRight=(()=>{(t=document.createElement("div")).classList.add("sd-get-scrollbar-width"),t.style.width="50px",t.style.height="50px",t.style.overflow="hidden",t.style.position="absolute",t.style.top="-200px",t.style.left="-200px",(e=document.createElement("div")).style.height="100px",t.appendChild(e),document.querySelector("body").appendChild(t);var e=document.querySelector(".sd-get-scrollbar-width").clientWidth,t=(t.style.overflowY="scroll",document.querySelector(".sd-get-scrollbar-width").clientWidth);return document.querySelector(".sd-get-scrollbar-width").remove(),e-t})():(a.style.marginRight="",a.querySelector(".ast-sticky-active")&&(a.querySelector(".ast-sticky-active").style.maxWidth="100%"),a.querySelector(".ast-header-sticky-active")&&(a.querySelector(".ast-header-sticky-active").style.maxWidth="100%"),a.querySelector(".ast-custom-footer")&&(a.querySelector(".ast-custom-footer").style.maxWidth="100%")),a.classList.add("portal-quick-view-is-open")),setTimeout(function(){e.classList.remove("loading"),e.classList.add("open"),document.querySelector(".portal-quick-view-bg").classList.add("open")},100)}async function d(o){o.preventDefault();var o=o.currentTarget,r=parseInt(o.getAttribute("data-post_id")||0);if(r){let e=document.querySelector("#portal-quick-view-modal"),t=document.querySelector(".portal-quick-view-bg");e&&!e.classList.contains("loading")&&e.classList.add("loading"),t&&!t.classList.contains("portal-quick-view-bg-ready")&&t.classList.add("portal-quick-view-bg-ready");var a=document.querySelector("#portal-quick-view-content"),c=(a.innerHTML="",document.createElement("iframe")),i=parseInt(o.getAttribute("data-comments")||"1");c.src=o.getAttribute("href")+"?simply_content=1&post_id="+r+"&comments="+i,c.style.width="100%",c.style.height="100%",c.style.border="none",(a.shadowRoot?(a.shadowRoot.innerHTML="",a.shadowRoot):a.attachShadow({mode:"open"})).appendChild(c),l(),setTimeout(()=>e?.querySelector("#portal-quick-view-content")?.focus(),500)}}function r(e){e&&e.preventDefault(),document.querySelector(".portal-quick-view-bg").classList.remove("portal-quick-view-bg-ready"),document.querySelector("#portal-quick-view-modal").classList.remove("open","loading"),document.querySelector(".portal-quick-view-bg").classList.remove("open"),document.querySelector("html").classList.remove("portal-quick-view-is-open"),document.querySelector("html").style.marginRight="",setTimeout(function(){document.querySelector("#portal-quick-view-modal").querySelector("#portal-quick-view-content").innerHTML=""},600)}function a(e){this===e.target&&r()}var e;e=()=>{n(),portal_archive.page=parseInt(portal_archive.page),document.querySelector("#portal-write-a-post")?.addEventListener("click",()=>{let t=document.querySelector("#portal-post-creation-modal");t?.classList.toggle("active");var e=t?.querySelector("#custom_post_title"),e=(e&&e.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),e=t?.querySelector(".jodit-wysiwyg"))&&e.focus()}),e.focus(),t?.querySelector(".post-comment-options")),o=(e?.classList.remove("hidden"),t?.querySelector(".portal-modal-footer"));e&&o&&o.insertBefore(e,o.firstChild),t?.querySelector(".portal-modal-footer"),document.querySelector("html")?.classList.toggle("portal-quick-view-is-open")}),document.querySelectorAll(".portal-modal-close")?.forEach(e=>e.addEventListener("click",()=>{document.querySelector("#portal-post-creation-modal")?.classList.remove("active"),document.querySelector("#portal-post-reaction-modal")?.classList.remove("active"),document.querySelector("html")?.classList.remove("portal-quick-view-is-open")})),document.querySelectorAll(".portal-modal-backdrop")?.forEach(e=>e.addEventListener("click",()=>{document.querySelector("#portal-post-reaction-modal")?.classList.remove("active");var e=document.querySelector("#portal-post-creation-modal");e&&e.classList.contains("active")||document.querySelector("html")?.classList.remove("portal-quick-view-is-open")})),document.querySelectorAll(".portal-linked-content-field")?.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=t?.dataset?.section||"",e=document.querySelector("."+e);document.querySelectorAll(".portal-extended-linked-field")?.forEach(e=>{e.classList.add("portal-hidden-field")}),e?.classList.remove("portal-hidden-field")})}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(document.querySelector("#portal-post-creation-modal")?.classList.remove("active"),document.querySelector("#portal-post-reaction-modal")?.classList.remove("active"),document.querySelector("html")?.classList.remove("portal-quick-view-is-open"),r())});document.querySelector("#portal-post-creation-submit")?.addEventListener("click",t),window.addEventListener("scroll",()=>{var e=document.querySelector(".portal-infinite-trigger");e&&0<=(e=e.getBoundingClientRect()).top&&e.bottom<=window.innerHeight+20&&(async()=>{if(!portal_archive.infinite_scroll_loading){portal_archive.infinite_scroll_loading=!0;var t=portal_archive.page+1,o=document.querySelector(".portal-pagination-loader"),r=(o&&o.classList.add("active"),document.querySelector(".portal-infinite-trigger")),a=r?.getAttribute("data-post_type")||"",c=r?.getAttribute("data-base_id")||0,e=r?.getAttribute("data-category")||0,i=r?.getAttribute("data-taxonomy")||"",l=r?.getAttribute("data-user_id")||0,s=new FormData,a=(s.append("post_type",a),s.append("taxonomy",i),s.append("base_id",parseInt(c)),s.append("category",parseInt(e)),s.append("page",t),s.append("user_id",parseInt(l)),s.append("sub_queried_page",portal_archive.sub_queried_page),await sdApiFetch("suredash/v1/load-more-posts","POST",s));if(a.success){i=a.data.content;let e=document.querySelector(".portal-content-area");"user-view"===portal_archive.sub_queried_page&&(e=document.querySelector('.portal-user-posts-content-assets[data-tab="posts"]')),""===i?(c=document.querySelector(".portal-no-more-posts"),r?.remove(),o?.remove(),c?.remove(),e.insertAdjacentHTML("beforeend",portal_archive.posts_loaded_message)):(portal_archive.page=t,o.classList.remove("active"),e.insertAdjacentHTML("beforeend",i),e.querySelectorAll(".portal-read-more-post")?.forEach(e=>e.addEventListener("click",d))),n()}else console.error(a.data.message);portal_archive.infinite_scroll_loading=!1}})()});var e=document.querySelector("#custom_post_content");e&&portalMakeItJoditEditor({element:e,placeholder:portal_global?.create_post_placeholder}),document.querySelectorAll(".portal-read-more-post")?.forEach(e=>e.addEventListener("click",d)),document.querySelector("#portal-quick-view-modal")?.addEventListener("click",a)},document.addEventListener("DOMContentLoaded",e),"interactive"!==document.readyState&&"complete"!==document.readyState||e()})();