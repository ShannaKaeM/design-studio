(()=>{let s=[];async function i(e){e.preventDefault(),e.stopPropagation();var e=e.currentTarget,t=(e.classList.add("disabled"),e.style.pointerEvents="none",new FormData),t=(t.append("item_id",parseInt(e.dataset.item_id||0)),t.append("item_type",e.dataset.item_type||"portal"),await sdApiFetch("suredash/v1/bookmark-item","POST",t));t.success?("bookmarked"===t.data.status?portalPushNotification("success",portal_global?.notification_messages?.item_bookmarked):portalPushNotification("success",portal_global?.notification_messages?.item_un_bookmarked),e.classList.toggle("bookmarked")):portalPushNotification("error","",t.data.message),e.classList.remove("disabled"),e.style.pointerEvents="auto"}async function n(t){t.preventDefault();var t=t.currentTarget,o=t?.dataset?.type||"like",r=t.closest("#portal-comment");if(r&&r.classList.contains("portal-qv-reaction-wrapper"))r=r.querySelector(".portal-post-qv-reaction-wrap"),("like"===o?(r?.querySelector(".portal-likes-area")?.classList.remove("portal-hidden-field"),r?.querySelector(".portal-comments-inner-wrap")):(r?.querySelector(".portal-comments-inner-wrap")?.classList.remove("portal-hidden-field"),r?.querySelector(".portal-likes-area")))?.classList.add("portal-hidden-field");else{var r=document.querySelector("#portal-post-reaction-modal"),a=r?.querySelector(".portal-pagination-loader"),l=r?.querySelector(".portal-post-reactor-content"),s=(l&&(l.innerHTML=""),t?.dataset?.post_id||0);if(s){document.querySelector("html")?.classList.toggle("portal-quick-view-is-open"),a?.classList.add("active"),r?.classList.remove("portal-modal-with-like"),r?.classList.remove("portal-modal-with-comment"),r?.classList.add("portal-modal-with-"+o);var i=r.querySelector(".no-comments-message"),i=(i&&i.remove(),r?.classList.toggle("active"),new FormData),i=(i.append("post_id",s),i.append("type",o),await sdApiFetch("suredash/v1/post-reactor-data","POST",i));if(a?.classList.remove("active"),i.success){l.innerHTML=i.data.content;var a=r.querySelector(".portal-comment-list"),a=(a&&!a.querySelector("li")&&((a=document.createElement("span")).textContent=portal_global?.no_comments_message,a.classList.add("no-comments-message","sd-flex","sd-justify-center","sd-align-center"),r.querySelector(".portal-modal-body").appendChild(a)),r.querySelector(".jodit-comment"));let e=r.querySelector(".comment-markup");var n=r.querySelector(".portal-modal-footer"),c=n.querySelector("#inline-comment-box"),c=(c&&c.remove(),e.querySelector('input[name="comment_post_ID"]').value=s,n.appendChild(e),portalMakeItJoditEditor({element:a,callback:()=>{e.classList.remove("sd-display-none"),e.classList.remove("sd-mt-20")}}),document.querySelector("#commentform"));if(c&&c.addEventListener("submit",submitComment),p(),t?.dataset?.reaction_type&&"comment"===o){var[d=null]=[r];d=d||document;let o=setInterval(()=>{var e=d.querySelector(".form-submit");let t=d.querySelector(".portal-modal-body");!e||!t||e.offsetHeight<=0||(clearInterval(o),t.scrollTop+t.clientHeight>=t.scrollHeight?e.scrollIntoView({behavior:"smooth",block:"end"}):t.scrollTop=t.scrollHeight)},100)}portalAttachTooltip()}else l.innerHTML=i.data.message}}}function c(e){e.preventDefault();var t,e=e.currentTarget;e&&((t=e.closest(".portal-user-profiles-wrap"))?t.classList:e.closest(".portal-user-profile-wrap")?.classList).toggle("active")}function p(){var t=document.querySelectorAll(".portal-post-bookmark-trigger");for(let e=0;e<t.length;e++)t[e].addEventListener("click",i);var o=document.querySelectorAll('.sd-post-reaction[data-reaction_type="like"], .sd-comment-like-reaction');for(let e=0;e<o.length;e++)o[e].addEventListener("click",likeTheEntity);var r=document.querySelectorAll('.portal-likes-count, .portal-comments-count, .sd-post-reaction[data-reaction_type="comment"]');for(let e=0;e<r.length;e++)r[e].addEventListener("click",n);var a=document.querySelectorAll(".portal-view-replies-btn");for(let e=0;e<a.length;e++)a[e].addEventListener("click",d);document.querySelectorAll(".portal-comment-list .comment").forEach(e=>{e.querySelector(".comment-reply-link")?.addEventListener("click",handleReplyClick)}),document.addEventListener("click",e);let l=document.querySelectorAll(".portal-copy-to-clipboard");for(let o=0;o<l?.length;o++)l[o]?.addEventListener("click",()=>{let e=l[o],t=document.createElement("input");t.setAttribute("value",e?.getAttribute("data-link")),document.body.appendChild(t),t.select(),document.execCommand("copy")&&(e?.classList.add("show-tooltip"),setTimeout(()=>{e?.classList.remove("show-tooltip")},1e3)),document.body.removeChild(t)});portalAttachTooltip(),initializeJoditCommentBoxes()}function e(t){var o=document.querySelectorAll(".portal-user-profiles-wrap, .portal-user-profile-wrap, .portal-store-post-actions, .portal-post-share-trigger, .portal-post-sharing-wrapper");for(let e=0;e<o.length;e++)o[e]&&!o[e].contains(t.target)&&o[e].classList.remove("active");document.querySelector(".portal-user-picker")?.contains(t.target)||removeUserPicker();var e=document.querySelector(".portal-notification-drawer"),r=t.target.closest(".portal-notification-trigger");!e?.classList.contains("notifications-opened")||e?.contains(t.target)||r||e.classList.remove("notifications-opened"),document.addEventListener("scroll",()=>{var e=document.querySelector(".emoji-picker-wrapper.active");removeUserPicker(),e&&e.classList.remove("active")})}function d(e){e.preventDefault(),e.stopPropagation();var e=e.currentTarget,t=e.closest(".portal-replies-wrapper").querySelector(".children.comment-replies");"none"!==t.style.display&&t.style.display?(t.style.display="none",e.classList.remove("active")):(t.style.display="flex",e.classList.add("active")),e.style.display="none"}var t;t=()=>{p(),document.addEventListener("suredashboard_global_recurring_trigger",()=>{p()}),document.querySelectorAll(".portal-notification-trigger").forEach(e=>{e.addEventListener("click",portalToggleNotificationDrawer),e.addEventListener("touchend",portalToggleNotificationDrawer)}),document.querySelectorAll(".portal-notification-drawer-close").forEach(e=>{e.addEventListener("click",portalToggleNotificationDrawer)}),portalRefreshUnreadNotificationsCount(),document.querySelectorAll(".notification-read-status").forEach(t=>{t.addEventListener("click",e=>{portalMarkNotification(e,"read"),portalToggleUserNotificationStatus([t.dataset.notificationTimestamp])})}),document.querySelectorAll(".notification-subtitle").forEach(e=>e.addEventListener("click",portalToggleNotificationSubtitle)),document.querySelector(".notification-mark-all-read")?.addEventListener("click",portalMarkAllNotificationsAsRead);let a=document.querySelector(".portal-user-profile-main"),l=document.querySelector(".portal-user-profile-editor-save");a&&l&&l.addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation(),l.disabled=!0;let o={};var t=a.querySelectorAll("input, textarea");for(let e=0;e<t.length;e++)o[t[e].name]=t[e].value;if(o.new_password!==o.confirm_new_password)alert(portal_global.password_mismatch_message),l.disabled=!1;else{let t=new FormData;Object.keys(o).forEach(e=>{t.append(e,o[e])});var e=document.querySelector('input[name="user_banner_image"]'),r=e?.files?.length||0,r=(e&&r&&t.append("user_banner_image",e.files[0]),document.querySelector('input[name="user_profile_photo"]')),e=r?.files?.length||0,e=(r&&e&&t.append("user_profile_photo",r.files[0]),await sdApiFetch("suredash/v1/update-user-profile","POST",t));e.success?portalPushNotification("success",portal_global?.notification_messages?.profile_updated):portalPushNotification("error","",e.data.message),l.disabled=!1,setTimeout(()=>{location.reload()},500)}});var t=document.querySelectorAll(".portal-user-view-tab");for(let e=0;e<t.length;e++)t[e].addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();var t=e.currentTarget,o=document.querySelectorAll(".portal-user-posts-content-assets");for(let e=0;e<o.length;e++)o[e].classList.remove("active");var r=document.querySelectorAll(".portal-user-view-tab");for(let e=0;e<r.length;e++)r[e].classList.remove("active");e=document.querySelector('.portal-user-posts-content-assets[data-tab="'+e.currentTarget.dataset.tab+'"]');e&&e.classList.add("active"),t.classList.add("active")});var o=document.querySelectorAll('.portal-header-avatar-wrap[data-view="logged-in"]');for(let e=0;e<o.length;e++)o[e].addEventListener("click",c);var r=document.querySelectorAll(".portal-aside-group-link");for(let e=0;e<r.length;e++)r[e].addEventListener("mouseover",e=>{e=e.currentTarget;e&&e.href&&(s.includes(e.href)||(s.push(e.href),portalPrefetch(e.href)))})},document.addEventListener("DOMContentLoaded",t),"interactive"!==document.readyState&&"complete"!==document.readyState||t()})();