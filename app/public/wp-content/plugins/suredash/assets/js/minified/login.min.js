SureDashLogin={settings:{},elements:{},loginButtonInnerElement:"",form:"",fields:"",spinner:`<svg width="20" height="20" viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg" stroke="#fff">
		<g fill="none" fill-rule="evenodd">
			<g transform="translate(1 1)" stroke-width="2">
				<circle stroke-opacity=".5" cx="18" cy="18" r="18"/>
				<path d="M36 18c0-9.94-8.06-18-18-18">
					<animateTransform
						attributeName="transform"
						type="rotate"
						from="0 18 18"
						to="360 18 18"
						dur="1s"
						repeatCount="indefinite"/>
				</path>
			</g>
		</g>
	</svg>`,classes:{inputError:"spectra-pro-login-form__input-error",fieldErrorMessage:"spectra-pro-login-form__field-error-message"},init(e,t={}){this._listenLogoutRedirect(t),this.settings=t,this.form=this.getElements(e),this.form&&(this.fields=this.getFormFields(),this.validateOnEntry(),this.passwordVisibility(),t.enableReCaptcha&&this.reCaptcha(t),t.enableGoogleLogin&&this.googleLogIn(t),t.enableFacebookLogin&&this.facebookLogIn(t),this.formSubmitInit(t.enableReCaptcha,t.recaptchaVersion))},_validateFields(e){""===e.value.trim()?this._setStatus(e,e.parentElement.previousElementSibling.innerText+" cannot be blank","error"):this._setStatus(e,null,"success")},_setStatus(e,t,r){var i=e.parentElement.querySelector(".spectra-pro-login-form__field-error-message");"success"===r&&(i&&i.remove(),e.classList.remove(SureDashLogin.classes.inputError)),"error"===r&&(e.classList.add(SureDashLogin.classes.inputError),i?i.innerHTML=t:((r=document.createElement("span")).classList="spectra-pro-login-form__field-error-message",r.innerHTML=t,e.parentElement.appendChild(r)))},_isFormSubmitable(){return SureDashLogin.form.getElementsByClassName(SureDashLogin.classes.inputError).length<1},_showValidationMessage(e){Object.entries(e).forEach(([e,t])=>{var r=document.createElement("span");r.classList="spectra-pro-login-form__field-error-message",r.innerHTML=t,SureDashLogin.form.querySelector('input[name="'+e+'"]')?.parentElement().append(r)})},_dispatchLoginRedirect(e){window.location.href=e.loginRedirectURL},_listenLogoutRedirect(e){var t=".uagb-block-"+e.block_id,t=document.querySelector(t+" .wp-block-spectra-pro-login__logged-in-message a"),r=this._sameOrigin(window.location,e.logoutRedirectURL);t&&!r&&t.addEventListener("click",()=>{window.open(e.logoutRedirectURL)})},_sameOrigin(e,t){e=new URL(e),t=new URL(t);return e.origin===t.origin},async _formSubmit(e=!1){let t=this.settings,r=SureDashLogin.form.querySelector(".spectra-pro-login-form-submit-button");var i=SureDashLogin.form.parentElement.querySelector(".spectra-pro-login-form-status"),s=SureDashLogin.form.querySelector(".spectra-pro-login-form"),o=s;o.elements=s.elements;let n=this.serializeArrayJS(o);n=n.reduce((e,{name:t,value:r})=>(e[t]=r,e),{}),t.enableReCaptcha&&(n.recaptchaStatus=t.enableReCaptcha,n.reCaptchaType=t.recaptchaVersion,e)&&(n["g-recaptcha-response"]=e);var a=new FormData;for(key in n)a.append(key,n[key]);SureDashLogin.form.style.opacity="0.45",r.setAttribute("disabled","disabled"),SureDashLogin.loginButtonInnerElement=r.innerHTML,r.innerHTML=SureDashLogin.spinner,i.innerHTML="";s=SureDashLogin.form.querySelector("."+SureDashLogin.classes.fieldErrorMessage);s&&s.remove();try{let e=await wp.apiFetch({path:"suredash/v1/block-login",method:"POST",body:a});if(e.success)i.innerHTML=`<div class="spectra-pro-login-form-status__success">${e.data}</div>`;else{let t="";"object"==typeof e.data&&Object.entries(e.data).forEach(([e])=>{t+=`<div class="spectra-pro-login-form-status__error-item">${e}</div>`}),i.innerHTML=t||`<div class="spectra-pro-login-form-status__error">${JSON.stringify(e.data).replace(/\\"/g,"'")}</div>`}setTimeout(()=>{SureDashLogin.form.style.opacity="1",r.innerHTML=SureDashLogin.loginButtonInnerElement,r.removeAttribute("disabled"),e.success?SureDashLogin._dispatchLoginRedirect(t):SureDashLogin._showValidationMessage(e.data)},1e3)}catch(e){console.error(e)}},getElements(e,t=null){let r=document.querySelector(e);if(r){if(t)return r.querySelector(t)}else{var i=document.querySelector('iframe[name="editor-canvas"]');if(i&&i.contentDocument&&(r=i.contentDocument.querySelector(e),t))return r=r.querySelector(t)}return r},getFormFields(){return SureDashLogin.form.getElementsByTagName('input[type!="hidden"]')},validateOnEntry(){let r=this;Object.entries(this.fields).forEach(([,t])=>{t.addEventListener("focusout",e=>{r._validateFields(t)})})},reCaptcha(e){var t;"v2"===e.recaptchaVersion&&SureDashLogin.settings.recaptchaSiteKey?((t=document.createElement("script")).type="text/javascript",t.src="https://www.google.com/recaptcha/api.js",document.head.appendChild(t)):"v3"===e.recaptchaVersion&&SureDashLogin.settings.recaptchaSiteKey&&((t=document.createElement("script")).type="text/javascript",t.src="https://www.google.com/recaptcha/api.js?render="+e.recaptchaSiteKey,document.head.appendChild(t))},formSubmitInit(t,r){this.form.addEventListener("submit",function(e){e.preventDefault(),Object.entries(SureDashLogin.fields).forEach(([e])=>{SureDashLogin._validateFields(e)}),SureDashLogin._isFormSubmitable()&&(!0===t&&"v3"===r?grecaptcha.ready(function(){grecaptcha.execute(SureDashLogin.settings.recaptchaSiteKey,{action:"submit"}).then(function(e){SureDashLogin._formSubmit(e)})}):SureDashLogin._formSubmit())})},facebookLogIn(o){window.is_fb_loggedin=!1;let n=this,a=this.form.parentElement.querySelector(".spectra-pro-login-form-status"),t=this.form.parentElement.querySelector("#uagb-pro-login-fbLink");var e,r,i;t&&(t.addEventListener("click",function(){is_fb_loggedin||FB.login(function(e){e.authResponse?FB.api("/me",{fields:"id, name, first_name, last_name, email, link, gender, locale, picture"},async function(e){var t=FB.getAuthResponse().userID,r=FB.getAuthResponse().accessToken,e=(window.is_fb_loggedin=!0,{id:e.id,name:e.name,first_name:e.first_name,last_name:e.last_name,email:e.email,link:e.link,send_email:!0});let i=SureDashLogin.form.querySelector(".spectra-pro-login-form-submit-button");SureDashLogin.form.style.opacity="0.45",i.setAttribute("disabled","disabled"),SureDashLogin.loginButtonInnerElement=i.innerHTML,i.innerHTML=SureDashLogin.spinner;var s=new FormData;s.append("data",JSON.stringify(e)),s.append("userID",t),s.append("security_string",r);try{let e=await wp.apiFetch({path:"suredash/v1/login-form-facebook",method:"POST",body:s});e.success?a.innerHTML=`<div class='spectra-pro-login-form-status__success'>${SureDashLogin.settings.loggedInMessage}</div>`:a.innerHTML=`<div class="spectra-pro-login-form-status__error">${e.data}</div>`,setTimeout(()=>{SureDashLogin.form.style.opacity="1",i.removeAttribute("disabled"),i.innerHTML=SureDashLogin.loginButtonInnerElement,!0===e.success&&n._dispatchLoginRedirect(o)},1e3)}catch(e){console.error(e)}}):a.innerHTML='<div class="spectra-pro-login-form-status__error"><strong>Error:</strong> User cancelled login or did not fully authorize.</div>'},{scope:"email"})}),window.fbAsyncInit=function(){var e=t.getAttribute("data-appid");FB.init({appId:e,cookie:!0,xfbml:!0,version:"v2.8"})},e=document,r="facebook-jssdk",i=e.getElementsByTagName("script")[0],e.getElementById(r)||((e=e.createElement("script")).id=r,e.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(e,i)))},googleLogIn(t){window.is_google_loggedin=!1;let r=this.form.parentElement.querySelector(".spectra-pro-login-form-status"),i=this.form.parentElement.querySelector("#uagb-pro-login-googleLink");if(i){let e=i.getAttribute("data-clientid");window.google.accounts.id.initialize({client_id:e,callback:e=>{e.credential?this.handleGoogleLogin(e.credential,t,i,r):r.innerHTML='<div class="spectra-pro-login-form-status__error">Failed to login. Please try again.</div>'},auto_select:!1,cancel_on_tap_outside:!0,context:"signin",ux_mode:"redirect",scope:"email profile"}),i.addEventListener("click",()=>{window.google.accounts.oauth2.initTokenClient({client_id:e,scope:"openid email profile https://www.googleapis.com/auth/drive.metadata.readonly https://www.googleapis.com/auth/calendar.readonly",callback:e=>{e.access_token?this.handleGoogleLogin(e.access_token,t,i,r):r.innerHTML='<div class="spectra-pro-login-form-status__error">Authorization failed. Please try again.</div>'},state:"custom_unique_state",include_granted_scopes:!0,prompt:"select_account"}).requestAccessToken()})}},async handleGoogleLogin(e,t,r,i){SureDashLogin.form.style.opacity="0.45",r.setAttribute("disabled","disabled"),SureDashLogin.loginButtonInnerElement=r.innerHTML;var s=new FormData;s.append("data",{send_email:!0}),s.append("id_token",e);try{var o=await wp.apiFetch({path:"suredash/v1/login-form-google",method:"POST",body:s});o.success||200===o?.status?(i.innerHTML=`<div class='spectra-pro-login-form-status__success'>${SureDashLogin.settings.loggedInMessage}</div>`,this._dispatchLoginRedirect(t)):i.innerHTML=`<div class="spectra-pro-login-form-status__error">${o?.data?.error||o?.data?.message||"Unexpected error occurred."}</div>`}catch(e){console.error("Login error:",e),i.innerHTML='<div class="spectra-pro-login-form-status__error">An error occurred during login. Please try again.</div>'}SureDashLogin.form.style.opacity="1",r.removeAttribute("disabled")},passwordVisibility(){function t(e){var t=SureDashLogin.form.querySelector("#password-visibility-"+SureDashLogin.settings.block_id);t.querySelector(".dashicons").classList.remove(e?"dashicons-hidden":"dashicons-visibility"),t.querySelector(".dashicons").classList.add(e?"dashicons-visibility":"dashicons-hidden")}SureDashLogin.form.querySelector("#password-visibility-"+SureDashLogin.settings.block_id)?.addEventListener("click",function(){var e=SureDashLogin.form.querySelector("#password-"+SureDashLogin.settings.block_id);"password"===e.getAttribute("type")?(e.setAttribute("type","text"),t(!1)):(e.setAttribute("type","password"),t(!0))})},serializeArrayJS(e){let r=[];return Array.prototype.slice.call(e.elements).forEach(function(t){!t.name||t.disabled||-1<["file","reset","submit","button"].indexOf(t.type)||("select-multiple"===t.type?Array.prototype.slice.call(t.options).forEach(function(e){e.selected&&r.push({name:t.name,value:e.value})}):-1<["checkbox","radio"].indexOf(t.type)&&!t.checked||r.push({name:t.name,value:t.value}))}),r}};