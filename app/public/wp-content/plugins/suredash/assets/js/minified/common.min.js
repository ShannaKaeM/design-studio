function sdApiFetch(e,t="GET",a=null,r=!0){try{var o={path:e,method:t,headers:{"X-WP-Nonce":portal_global.wp_rest_nonce}},i=(r&&a?(o.body=a,delete o.headers["Content-Type"]):a&&(o.body=JSON.stringify(a),o.headers["Content-Type"]="application/json"),wp?.apiFetch(o));return i}catch(e){throw console.error("API Request Failed:",e),e}}function portalPushNotification(e,a="",r=""){var o=document.querySelector("#portal-notification-toaster");if(o){var i=Math.floor(1e5+9e5*Math.random());let t=document.createElement("div");t.classList.add("portal-notification-toaster-content"),t.classList.add("sd-box-shadow"),t.id="portal-notifier-"+i,t.dataset.type=e,""!==r&&console.error(r);i=""!==a?a:portal_global?.notification_dataset?.[e]?.message||"";t.innerHTML=`<div class="portal-notification-toaster-icon"> ${portal_global?.notification_dataset?.[e]?.icon||""} </div> <span class="portal-notification-toaster-message-text"> ${i} </span> <span class="portal-notification-close-icon"> ${portal_global?.close_icon||""} </span>`,setTimeout(()=>{t.classList.add("notifying")},50),o.appendChild(t),o.querySelectorAll(".portal-notification-close-icon").forEach(e=>{e.addEventListener("click",()=>{t.remove()})}),setTimeout(()=>{t.classList.remove("notifying")},3e3),setTimeout(()=>{t.remove()},3500)}}function portalPrefetch(e){var t=document.createElement("link");t.rel="prefetch",t.href=e,document.head.appendChild(t)}function portalSetCookie(e,t,a){let r="";var o;a&&((o=new Date).setTime(o.getTime()+24*a*60*60*1e3),r="; expires="+o.toUTCString()),document.cookie=e+"="+(t||"")+r+"; path=/"}let portalToggleNotificationDrawer=e=>{e.preventDefault(),e.stopPropagation();e=e.currentTarget.closest(".wp-block-suredash-notification").querySelector(".portal-notification-drawer");e&&(e.classList.contains("notifications-opened")?e.classList.remove("notifications-opened"):e.classList.add("notifications-opened"))};async function portalToggleUserNotificationStatus(e){var t=new FormData,e=(t.append("notification_timestamps",JSON.stringify(e)),await sdApiFetch("suredash/v1/update-user-notifications","POST",t));e.success&&portalRefreshUnreadNotificationsCount()}function portalShowUnreadNotifications(){document.querySelectorAll(".notification-read-status.read").forEach(e=>{e.closest(".portal-notification-item").style.display="none"})}function portalShowAllNotifications(){var e=document.querySelector(".portal-no-notifications-message");e&&e.remove(),document.querySelectorAll(".portal-notification-item").forEach(e=>{e.style.removeProperty("display")})}function portalMarkNotification(e,t="read"){e instanceof Event&&(e.preventDefault(),e.stopPropagation(),e=e.currentTarget),"read"===t?(e.classList.remove("unread"),e.classList.add("read")):(e.classList.remove("read"),e.classList.add("unread")),portalRefreshUnreadNotificationsCount()}function portalMarkAllNotificationsAsRead(e){e.preventDefault(),e.stopPropagation();let t=[];document.querySelectorAll(".notification-read-status.unread").forEach(e=>{t.push(e.dataset.notificationTimestamp),portalMarkNotification(e,"read")}),0<t.length&&portalToggleUserNotificationStatus(t)}function portalToggleNotificationSubtitle(e){e.preventDefault(),e.stopPropagation(),document.querySelectorAll(".notification-subtitle.active").forEach(e=>e.classList.remove("active")),e.currentTarget.classList.toggle("active"),(e.currentTarget.classList.contains("notification-all")?portalShowAllNotifications:portalShowUnreadNotifications)()}function portalRefreshUnreadNotificationsCount(){var e=document.querySelectorAll(".notification-unread-count");if(0!==e.length){let a=document.querySelectorAll(".notification-read-status.unread");e.forEach(e=>{var t;e&&0!==a.length?99<a.length?e.innerText="99+":e.innerText=a.length:(e.style.display="none",e=window.innerWidth,t=document.querySelector(".notification-unread"),e<=420?t.style.display="none":(t.style.opacity="0.5",t.style.pointerEvents="none"))})}}let createModalDialog=e=>{let t=document.createElement("div"),a=(t.className="sd-jd-modal-overlay",document.createElement("div"));a.className="sd-modal-dialog",t.addEventListener("wheel",e=>{e.stopPropagation(),e.preventDefault()}),a.addEventListener("wheel",e=>{e.stopPropagation()}),a.innerHTML=e,document.body.appendChild(t),document.body.appendChild(a);e=()=>{t.remove(),a.remove()};return a.querySelector(".sd-modal-close").addEventListener("click",e),t.addEventListener("click",e),a},closeModalDialog=()=>{var e=document.querySelector(".sd-modal-close");e&&e.click()},createUserPicker=e=>{let o=document.createElement("form");o.className="portal-user-picker sd-display-none";var t=document.createElement("div"),a=(t.className="user-wrapper",document.createElement("div"));a.className="user-search-wrapper",o.appendChild(a);let i=document.createElement("div");i.className="user-list-wrap sd-flex-col sd-gap-4";a=document.createElement("span");a.className="sd-flex sd-justify-center sd-items-center",a.innerHTML=e.loading_icon,i.appendChild(a),t.appendChild(i),o.appendChild(t),document.body.appendChild(o);let r=[];let s=-1;function n(){i.querySelectorAll(".user-item").forEach((e,t)=>{e.style.backgroundColor=t===s?"#f0f0f0":""})}o.addEventListener("keydown",e=>{var t,a,r=i.querySelectorAll(".user-item");switch(e.key){case"ArrowDown":e.preventDefault(),s=(s+1)%r.length,n();break;case"ArrowUp":e.preventDefault(),s=s<=0?r.length-1:s-1,n();break;case"Enter":e.preventDefault(),e.stopPropagation(),0<=s&&r[s]&&(t=r[s].dataset.userId,a=r[s].textContent,onUserSelect(a,t));break;case"Escape":o.style.display="none",s=-1}}),o.onsubmit=e=>e.preventDefault(),(async()=>{try{r=await portalSearchUsers(""),i.innerHTML="",0===r.length?i.innerHTML='<div class="user-item sd-font-14">No users found</div>':r.forEach(e=>{var t=document.createElement("div");t.className="user-item sd-font-14 sd-flex sd-p-4 sd-gap-4 sd-items-center sd-cursor-pointer",t.innerHTML=`<p class="portal-avatar-24 sd-m-0 sd-p-0 user-picker-avatar">${e.avatar}</p>`+`<p class="user-item-name sd-m-0 sd-p-0" data-username="${e.display_name}">${e.display_name}</p>`,t.dataset.userId=e.id,t.dataset.username=e.display_name,i.appendChild(t)})}catch(e){console.error("Error loading users:",e),i.innerHTML='<div class="user-item sd-font-14">Error loading users</div>'}})()};function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function searchUser(a,p){var e=getCursorInfo();if(e){var t=e.textBeforeCursor.match(/@(\S+)$/);if(t){window.lastCursorInfo=e,window.lastMatch=t,window.lastFullMatchText=t[0];let c=document.querySelector(".portal-user-picker");e=c.querySelector(".user-list-wrap").querySelectorAll(".user-item"),t=(e.forEach(e=>{var t=e.querySelector(".user-item-name").dataset.username;if(t.toLowerCase().includes(a.toLowerCase())?e.classList.remove("sd-display-none"):e.classList.add("sd-display-none"),"true"!==e.dataset.eventListenerAdded){let d=e;d.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();t=d.dataset.userId,t=`<a class="sd-user-mentioned" href="/{portal_slug}/user-view/?id=${t}/" data-portal_mentioned_user="${t}" target="_blank">@${d.dataset.username}</a>`;p.selection.focus();try{for(var e,a,r,o,i,s=window.lastFullMatchText,n=[],l=document.createTreeWalker(p.editor,NodeFilter.SHOW_TEXT,null,!1);e=l.nextNode();)new RegExp(`(^|\\s)${escapeRegExp(s)}($|\\s|[.,;:!?)])`).test(e.nodeValue)&&n.push(e);0<n.length&&0<=(r=(a=n[0]).nodeValue.indexOf(s))&&((o=document.createRange()).setStart(a,r),o.setEnd(a,r+s.length),(i=window.getSelection()).removeAllRanges(),i.addRange(o)),p.selection.insertHTML(t)}catch(e){console.error("Error replacing mention:",e),p.selection.insertHTML(t)}c.classList.add("sd-display-none")}),d.dataset.eventListenerAdded="true"}}),Array.from(e).filter(e=>!1===e.classList.contains("sd-display-none")));0===t.length&&c.classList.add("sd-display-none")}}}function removeUserPicker(){var e=document.querySelector(".portal-user-picker");e&&e.remove()}async function portalSearchUsers(e){if(!portal_global.user_logged_in)return[];await new Promise(e=>setTimeout(e,500));var t=new FormData,e=(t.append("search",e),await sdApiFetch("suredash/v1/search-user","POST",t));return e.data||[]}function getCursorPositionRelativeToEditor(e){var t,a=window.getSelection();return a.rangeCount?(a=a.getRangeAt(0).cloneRange(),(t=document.createElement("span")).textContent="​",a.insertNode(t),a=t.getBoundingClientRect(),t.remove(),{top:a.top,left:a.left}):null}let tagUserButton=s=>({name:"tagUser",popup:o=>{let i=o.create.fromHTML(`<style type="text/css"> .portal-jodit-user-selector { margin: 0; padding: 5px 0; width: 100%; } .portal-user-results { padding: 0; margin: 0; display: flex; flex-direction: column; max-height: 200px; } .portal-editor-user-selection { cursor: pointer; padding: 5px; font-size: 14px; } .portal-editor-user-selection:hover { background: var( --jd-color-button-background-hover ); } .portal-editor-user-selection:first-child { margin-top: 5px; } </style>
						<div class="portal-editor-user-selection-wrap portal-content">
							<input type="search" class="portal-jodit-user-selector" placeholder="${s.jodit_messages.search_user}"  style="width: 100%; padding: 5px; max-height: 35px;" />
							<div class="portal-user-results"></div>
						</div>`);return i.querySelector(".portal-jodit-user-selector").addEventListener("input",async t=>{t=t.target.value;if(t.length<3)i.querySelector(".portal-user-results").innerHTML="",i.querySelector(".portal-user-results").innerHTML='<div class="portal-editor-user-selection sd-font-14"> '+portal_archive.minimum_3_characters+" </div>";else{let e=[];try{var a=new FormData,r=(a.append("search",t),await sdApiFetch("suredash/v1/search-user","POST",a));if(0===(e=r.data||[]).length)return i.querySelector(".portal-user-results").innerHTML="",void(i.querySelector(".portal-user-results").innerHTML='<div class="portal-editor-user-selection"> '+s.jodit_messages.no_user_found+" </div>")}catch(e){console.error("Error searching users:",e)}t=e.map(e=>`<div class="portal-editor-user-selection" data-user_id="${e.id}">${e.display_name}</div>`).join("");i.querySelector(".portal-user-results").innerHTML="",i.querySelector(".portal-user-results").innerHTML=t,i.querySelectorAll(".portal-editor-user-selection").forEach(e=>{e.addEventListener("click",e=>{var t=e.target.dataset.user_id,e=e.target.innerText;o.s.insertHTML(`<a href="/{portal_slug}/user-view/?id=${t}/" data-portal_mentioned_user="${t}" target="_blank">@${e}</a>`)})})}}),i}}),giphyButton=i=>i.giphy_api_key?{name:"giphy",popup:a=>{let r=a.create.fromHTML(`<style type="text/css">
						.portal-jodit-user-selector { margin: 0; padding: 5px 0; width: 100%; }
						.portal-user-results {
							padding: 0; margin: 0;
							max-width: 230px; /* Limit width */
							display: flex; flex-direction: column;
						}
						.portal-editor-gif-selection {
							cursor: pointer;
							font-size: 14px;
							padding: 4px;
							height: fit-content;
							display: block; /* Required for column layout */
						}
						.portal-editor-gif-selection img {
							display: flex;
							height: auto;
							width: 100%;
						}
						.gif-grid-container{
							width: 100%;
							max-height: 300px;
							overflow-y: auto;
							overflow-x: hidden;
						}

						.gif-grid{
							display:flex;
							flex-direction: row;
						}
						.portal-editor-gif-selection-wrap{
							width: 100%;
							max-width: 330px;
						}
						</style>
						<div class="portal-editor-gif-selection-wrap portal-content">
							<input type="search" class="portal-jodit-user-selector" placeholder="${i.jodit_messages.search_gif}"  style="width: 100%; padding: 5px; max-height: 35px;" />
							<div class="gif-grid-container">
								<div class="gif-grid">
									<div class="portal-user-results col-1"></div>
									<div class="portal-user-results col-2"></div>
								</div>
								<div data-gif-result class="portal-gif-result"></div>
							</div>
						</div>`),o;return r.querySelector(".portal-jodit-user-selector").addEventListener("input",async e=>{let t=e.target.value;if(t.length<3)r.querySelectorAll(".portal-user-results").forEach(e=>{e.innerHTML="",r.querySelector("[data-gif-result]").innerHTML='<p class="sd-font-14"> '+i.jodit_messages.minimum_3_characters+" </p>"});else try{clearTimeout(o),o=setTimeout(()=>{searchGifs(t,0,a)},500)}catch(e){console.error("Error searching gifs:",e)}}),r}}:null,isLoading=!1,currentOffset=0,LIMIT=10,totalCount=0;function getGifs(e,c=0,p){if(!isLoading){isLoading=!0;var t=document.querySelector(".sd-modal-dialog");let a=t.querySelector(".portal-user-results.col-1"),r=t.querySelector(".portal-user-results.col-2"),o=t.querySelector(".portal-user-results.col-3"),i=t.querySelector("[data-gif-result]"),s=t.querySelector(".portal-gif-result"),n=parseInt(a.dataset.height||0),l=parseInt(r.dataset.height||0),d=parseInt(o.dataset.height||0);0===c&&(n=0,l=0,d=0,a.dataset.height="0",r.dataset.height="0",o.dataset.height="0"),fetch(`https://api.giphy.com/v1/gifs/search?q=${encodeURIComponent(e)}&api_key=${portal_global.giphy_api_key}&limit=${LIMIT}&offset=${c}&rating=g`).then(e=>{if(e.ok)return e.json();throw portalPushNotification("error",e.statusText),s.innerHTML=portal_global.jodit_messages.api_error,new Error("HTTP error! Status: "+e.status)}).then(e=>{var t=e.data||[];totalCount=e.pagination.total_count,0===t.length&&0===c?s.innerHTML=portal_global.jodit_messages.no_gif_found:(s.innerHTML="",t.forEach(e=>{var t=parseInt(e.images.fixed_width.height),e=`
					<div class="portal-editor-gif-selection portal-skeleton-row" data-gif-id="${e.id}">
						<img
							src="${e.images.fixed_width.webp}"
							alt="${e.title}"
							loading="lazy"
							class="hidden"
							onload="this.classList.remove('hidden'); this.parentElement.classList.remove('portal-skeleton-row');"
						/>
					</div>`;n<=l&&n<=d?(a.insertAdjacentHTML("beforeend",e),n+=t+6,a.dataset.height=n):l<=n&&l<=d?(r.insertAdjacentHTML("beforeend",e),l+=t+6,r.dataset.height=l):(o.insertAdjacentHTML("beforeend",e),d+=t+6,o.dataset.height=d)}),attachGifClickListeners(p),initInfiniteScroll(p),currentOffset=c+t.length,totalCount===currentOffset&&(i.innerHTML=""),isLoading=!1)}).catch(e=>{console.error("Error fetching data:",e),isLoading=!1})}}function handleTabSwitching(a,r,o){a.forEach(t=>{t.addEventListener("click",()=>{var e=t.getAttribute("data-tab-attribute");t.hasAttribute("data-attach-button")?o.querySelector(".sd-attach-button").classList.remove("sd-display-none"):o.querySelector(".sd-attach-button").classList.add("sd-display-none"),a.forEach(e=>e.classList.remove("active")),r.forEach(e=>e.classList.add("sd-display-none")),t.classList.add("active"),o.querySelector(`[data-tab-content="${e}"]`).classList.remove("sd-display-none")})})}function getCursorInfo(){var e,t,a,r=window.getSelection();return r&&r.rangeCount?(e=(r=r.getRangeAt(0)).cloneRange(),(t=document.createElement("span")).textContent="​",r.insertNode(t),a=t.getBoundingClientRect(),t.remove(),e.selectNodeContents(e.startContainer.ownerDocument.body),e.setEnd(r.startContainer,r.startOffset),{rect:a,textBeforeCursor:e.toString()}):null}function portalAttachTooltip(){if(!document.querySelector(".portal-tooltip-light")&&!document.querySelector(".portal-tooltip-dark")){let e=document.createElement("div");e.className="portal-tooltip portal-tooltip-dark portal-content sd-flex sd-fixed sd-radius-8 sd-py-8 sd-px-12 sd-opacity-0 sd-hidden sd-z-100",e.style.opacity="0";var t=document.createElement("div"),a=(t.className="portal-tooltip-content",document.createElement("span")),r=(a.className="portal-tooltip-title",document.createElement("span"));r.className="portal-tooltip-description",t.appendChild(a),t.appendChild(r),e.appendChild(t),document.body.appendChild(e)}let n=document.querySelector(".portal-tooltip-light")||document.querySelector(".portal-tooltip-dark"),l="rtl"===document.dir||"rtl"===document.documentElement.getAttribute("dir")||"rtl"===document.body.getAttribute("dir")||"rtl"===window.getComputedStyle(document.body).direction;document.querySelectorAll(".tooltip-trigger").forEach(s=>{s.hasAttribute("data-listener-added")||(s.addEventListener("mouseenter",()=>{var e=n.querySelector(".portal-tooltip-title"),t=n.querySelector(".portal-tooltip-description"),a=(e.textContent=s.dataset.tooltipTitle,s.dataset.tooltipDescription&&"undefined"!==s.dataset.tooltipDescription?(t.innerHTML=s.dataset.tooltipDescription?.replace(/\n/g,"<br>"),t.classList.remove("sd-hidden")):t.classList.add("sd-hidden"),n.setAttribute("data-position",s.dataset.tooltipPosition||"right"),s.getBoundingClientRect());let r=s.dataset.tooltipPosition||"right";l&&("left"===r?r="right":"right"===r&&(r="left"));var o=n.offsetWidth,i=n.offsetHeight;switch(r){case"right":n.style.left=a.right+"px",n.style.top=a.top+a.height/2-i/2+"px";break;case"left":n.style.left=a.left-o+"px",n.style.top=a.top+a.height/2-i/2+"px";break;case"top":n.style.left=a.left+a.width/2-o/2+"px",n.style.top=a.top-i+"px";break;case"bottom":n.style.left=a.left+a.width/2-o/2+"px",n.style.top=a.bottom+"px";break;default:n.style.left=a.right+"px",n.style.top=a.top+a.height/2-i/2+"px"}n.style.opacity="1",n.classList.remove("sd-hidden"),n.style.zIndex="9999999"}),s.addEventListener("mouseleave",()=>{n.style.opacity="0",n.classList.add("sd-hidden")}),s.setAttribute("data-listener-added","true"))})}async function likeTheEntity(e){e.preventDefault();var e=e.currentTarget,t=e?.dataset?.entity||"post";let a=parseInt(e?.dataset?.post_id||0);"comment"===t&&(a=parseInt(e?.dataset?.comment_id||0)),e.classList.add("disabled"),e.style.pointerEvents="none";var r=new FormData,o=(r.append("entity_id",a),r.append("entity",t),await sdApiFetch("suredash/v1/entity-reaction","POST",r));if(o.success){if("comment"===t){r=e.closest(".portal-comment-meta")?.querySelector(".sd-comment-like-count");r.dataset.count=o.data.like_count,r.setAttribute("data-tooltip-description",o.data.tooltip_content),(r?.querySelector(".counter")).innerText=o.data.like_count,"liked"===o.data.like_status?e.innerText=portal_global.liked_text:e.innerText=portal_global.like_text}else{var i=document.querySelectorAll("#portal-post-"+e?.dataset?.post_id);for(let e=0;e<i.length;e++){i[e].querySelector('.sd-post-reaction[data-reaction_type="like"]').classList.toggle("liked");var s=i[e].querySelector(".portal-likes-count");s.dataset.count=o.data.like_count,s.querySelector(".counter").innerText=o.data.like_count}}e.classList.remove("disabled"),e.style.pointerEvents="auto"}else portalPushNotification("error","",o.data.message)}function extractIntegerFromString(e){return(e=e&&e.match(/\d+/))?parseInt(e[0],10):null}function searchGifs(e,n=0,l){if(!isLoading){isLoading=!0;var t=document.querySelector(".portal-editor-gif-selection-wrap");let a=t.querySelector(".portal-user-results.col-1"),r=t.querySelector(".portal-user-results.col-2"),o=t.querySelector("[data-gif-result]"),i=parseInt(a.dataset.height||0),s=parseInt(r.dataset.height||0);0===n&&(i=0,s=0,a.dataset.height="0",r.dataset.height="0",t=`
		<div style="display: flex; flex-direction: row; width: 330px;">
			<div class="portal-skeleton-row" style="width: 98%; height: 100px; margin:4px; border-radius: 4px;"></div>
			<div class="portal-skeleton-row" style="width: 98%; height: 100px; margin:4px; border-radius: 4px;"></div>
		</div>
			`,o.innerHTML="",o.insertAdjacentHTML("beforeend",t),o.insertAdjacentHTML("beforeend",t)),fetch(`https://api.giphy.com/v1/gifs/search?q=${encodeURIComponent(e)}&api_key=${portal_global.giphy_api_key}&limit=${LIMIT}&offset=${n}&rating=g`).then(e=>e.json()).then(e=>{var t=e.data||[];totalCount=e.pagination.total_count,0===t.length&&0===n?a.innerHTML='<div class="portal-editor-gif-selection">'+portal_global.jodit_messages.no_gif_found+"</div>":(0===n&&(a.innerHTML="",r.innerHTML=""),t.forEach(e=>{var t=parseInt(e.images.fixed_width.height),e=`
	                <div class="portal-editor-gif-selection" data-user_id="${e.id}">
	                    <img
						src="${e.images.fixed_width.webp}"
						alt="${e.title}"
						/>
	                </div>`;a.querySelectorAll(".portal-skeleton-row").forEach(e=>{e.remove()}),r.querySelectorAll(".portal-skeleton-row").forEach(e=>{e.remove()}),i<=s?(a.insertAdjacentHTML("beforeend",e),i+=t+10,a.dataset.height=i):(r.insertAdjacentHTML("beforeend",e),s+=t+10,r.dataset.height=s)}),attachGifClickListeners(l),currentOffset=n+t.length,totalCount===currentOffset&&(o.innerHTML=""),isLoading=!1)}).catch(e=>{console.error("Error fetching data:",e),isLoading=!1})}}function attachGifClickListeners(t){document.querySelector(".gif-grid").querySelectorAll(".portal-user-results img").forEach(e=>{e.hasAttribute("data-click-listener-added")||(e.setAttribute("data-click-listener-added","true"),e.addEventListener("click",()=>{t&&t.s&&"function"==typeof t.s.insertHTML?t.s.insertHTML(`<img src="${e.src}" alt="${e.alt}">`):console.error("Editor instance is not available or insertHTML function is not defined."),closeModalDialog()}))})}function initInfiniteScroll(a){let i=document.querySelector(".gif-grid");if(i&&!i.hasAttribute("data-scroll-event-listener-added"))i.addEventListener("wheel",e=>{var t=i.scrollTop,a=i.scrollHeight,r=i.clientHeight,o=0===t&&e.deltaY<0,a=a<=t+r&&0<e.deltaY;(o||a)&&(e.preventDefault(),e.stopPropagation())}),i.addEventListener("scroll",e=>{var t;e.stopPropagation(),e.preventDefault(),e=i.scrollTop,t=i.clientHeight,i.scrollHeight-(e+t)<=200&&!isLoading&&currentOffset<totalCount&&3<=(e=document.querySelector("#giphy-search-box"))?.value.length&&getGifs(e.value,currentOffset,a)}),i.setAttribute("data-scroll-event-listener-added","true")}function handleBase64Images(s,n){var e=s.match(/src=['"]*data:image\/(gif|png|jpeg|jpg);base64,([^'"]+)['"]*/g);return e&&e.forEach((e,t)=>{var a=e.match(/data:image\/(gif|png|jpeg|jpg);base64,([^'"]+)/),r=a[1],o=atob(a[2]),i=new Array(o.length);for(let e=0;e<o.length;e++)i[e]=o.charCodeAt(e);a=new Uint8Array(i),a=new Blob([a],{type:"image/"+r});n.append("image_"+t,a,`image_${t}.`+r),s=s.replace(e,`src="" data-image-index="${t}"`)}),s}async function handleBlobImages(o,i){var e=o.match(/src=['"](blob:http[^'"]+)['"]/g);return e&&(e=e.map(async(e,t)=>{var a=e.match(/src=['"]([^'"]+)['"]/)[1];try{var r=await(await fetch(a)).blob();i.append("image_"+t,r,`image_${t}.`+r.type.split("/")[1]),o=o.replace(e,`src="" data-image-index="${t}"`)}catch(e){console.error("Error fetching blob:",e)}}),await Promise.all(e)),o}